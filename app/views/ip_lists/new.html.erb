<!-- app/views/ip_lists/new.html.erb -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>作業日報管理システム(V2)</title>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
</head>
<body>
  <h1>QRコードをスキャンしてください</h1>

  <%= turbo_stream_from @qr %>

  <div class="card">
    <div class="card-body">
      <p>有効期限: <%= l @qr.expires_at %></p>
      <!-- 方式1: サーバ側でPNGを返す -->
      <img src="<%= edit_ip_list_path(@qr.id) %>" alt="QR" width="320" height="320">

      <!-- 方式2（任意）: デバッグ用にJSONを表示 -->
      <details class="mt-3">
        <summary>QR JSON（デバッグ）</summary>
        <pre><%= @payload_json %></pre>
      </details>
    </div>
  </div>

  <!-- 自動submit用フォーム（最終確定） -->
  <%= form_with url: ip_lists_path, method: :post, id: "qr-finalize-form", data: { turbo: true } do |f| %>
    <%= hidden_field_tag :token, @qr.token %>
  <% end %>
</body>
</html>
