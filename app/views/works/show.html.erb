<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>作業日報管理システム(V2)</title>
  <%= javascript_include_tag 'application' %>
  <%= csrf_meta_tags %>
  <script type="text/javascript">
   I18n.defaultLocale = "<%= I18n.default_locale %>";
   I18n.locale = "<%= I18n.locale %>";
  </script>
<%= stylesheet_link_tag 'work-show', :media => 'all' %>
</head>
<body>

<%= render partial: "show_base" %>
<%= render partial: "show_workers" %>
<% if (@work_lands.count > 0 or @work.work_kind.land_flag) and current_organization.lands_count > 0 %>
  <%= render partial: "show_lands" %>
<% end %>
<% if (@machines.count > 0 or @work.work_kind.machine_kinds.count > 0) and current_organization.machines_count > 0 %>
  <%= render partial: "show_machines" %>
<% end %>
<% if (@chemicals.count > 0 or @work.work_kind.chemical_kinds.count > 0) and current_organization.chemicals_count > 0 %>
  <%= render partial: "show_chemicals" %>
<% end %>
<% if @broccoli %>
  <%= render partial: "show_broccoli" %>
<% end %>
<% if @work.fixed_at.nil? && updatable_work(current_user, @work) %>
<%= link_to '削除',raw(work_path(id: @work)), method: :delete, class: "btn btn-danger", data: {confirm: "本当に削除してもよろしいですか?"} %>
<% end %>
<% unless current_user.visitor? %><%= button_tag "新規登録",  type: :button, class: "btn btn-success", onclick: raw("location.href = '" + new_work_path + "';") %><% end %>
<% if updatable_work(current_user, @work) %>
<%= button_tag "印刷", type: :button, class: "btn btn-success", onclick: raw("execPrint('" + print_work_path(@work.id) + "');") %>
<% end %>
<%= button_tag "戻る",  type: :button, class: "btn btn-default", :onclick => raw("location.href = '" + (session[:work_referer] ? session[:work_referer] : works_path) + "';") %>
<%= render partial: "show_stamp"%>
<% if @work.fixed_at.nil? && updatable_work(current_user, @work) %>
<script type="text/javascript">
$(function() {
  $("#cover_work").height($("#content_work").height()).width($("#content_work").width());
  $("#cover_workers").height($("#content_workers").height()).width($("#content_workers").width());
  $("#cover_lands").height($("#content_lands").height()).width($("#content_lands").width());
  $("#cover_machines").height($("#content_machines").height()).width($("#content_machines").width());
  $("#cover_chemicals").height($("#content_chemicals").height()).width($("#content_chemicals").width());
});
</script>
<% end %>
<script type="text/javascript">
function execPrint(url) {
    if(bootbox.confirm("印刷を実行した場合、印刷した日報が原紙となります。印刷しますか？", function(result) {
        if(result) {
            $.ajax({
                url: url,
                type: "PATCH",
                dataType: "html"
            }).done(function(html) {
                $("#print_stamp").html(html);
                window.print();
                bootbox.alert("印刷した日報を原紙として保管してください。");
            });
        }
    }));
}
$(function() {
  $("#cover_broccoli").height($("#content_broccoli").height()).width($("#content_broccoli").width());
});
</script>
</body>
</html>
