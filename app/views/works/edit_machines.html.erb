<h1>作業日報(作業機械)登録</h1>
<%= error_print(@work) %>
<%= form_for(@work, url: {action: :update }, html: {method: :put}) do |f| %>
<%= render(:partial => 'show_work', :locals => {:f => f}) %>
  <% if @results.count == 0 %>
  <h2>作業者を先に登録してください。</h2>
  <% else %>
    <% if @company_machines.count > 0 %>
      <h2>機械・オペレーター(組合管理)</h2>
      <table class="list">
        <thead>
          <tr>
            <% machine_type_ids = @company_machines.pluck(:machine_type_id).uniq %>
            <th rowspan="2">作業者</th>
            <% machine_type_ids.each do |machine_type_id| %>
              <th colspan="<%= @company_machines.where(machine_type_id: machine_type_id).count %>"><%= MachineType.find(machine_type_id).name %></th>
            <% end %>
          </tr>
          <tr>
            <% @company_machines.each do |machine| %>
              <th><%= machine.name %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% @results.each do |result| %>
            <tr>
              <td><%= result.worker.name %></td>
                <% @company_machines.each do |machine| %>
                  <% machine_result = result.machine_results.where(machine_id: machine).first %>
                  <td><%= number_field_tag "machine_hours[#{machine.id.to_s}][#{result.id}]", machine_result ? machine_result.hours : 0, {step:0.5, min: 0, max: 99} %></td>
                <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  <% end %>
  <% if @owner_machines.count > 0 %>
  <% end %>
  <br />
  <%= f.submit '登録', :name => 'regist_machines' %>
  <%= f.submit '戻る', :name => 'cancel' %>
<% end %>
