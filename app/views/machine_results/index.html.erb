<h1>世帯別機械一覧</h1>
<%= button_tag "戻る",  type: :button, :onclick => raw("javascript:location.href = '" + root_path + "';") %>
<%= stylesheet_link_tag 'work-lists', :media => 'all' %>
<table class="list">
  <thead>
    <tr>
      <th>所有世帯</th>
      <th>機械種別</th>
      <th>作業日</th>
      <th>作業種別</th>
      <th>作業内容</th>
      <th>単価</th>
      <th>作業量</th>
      <th>単位</th>
      <th>使用料</th>
    </tr>
  </thead>
  <tbody>
    <% old_owner = nil %>
    <% home_amount = 0 %>
    <% total_amount = 0 %>
    <% even = false %>
    <% @results.each do |result| %>
      <% if old_owner && (old_owner.id != result.owner.id) %>
        <tr class="<%= even ? 'even_color' : 'odd_color' %>">
          <td><%= old_owner.name %></td>
          <td colspan="7">合計</td>
          <td class="numeric"><%= number_to_currency(home_amount, {precision: 0, unit: ""}) %></td>
        </tr>
        <% home_amount = 0 %>
        <% even = !even %>
      <% end %>
      <tr class="<%= even ? 'even_color' : 'odd_color' %>">
        <td><%= result.owner.name %></td>
        <td><%= result.machine.machine_type.name %></td>
        <td><%= result.worked_at %></td>
        <td><%= result.work_type_name %></td>
        <td><%= result.work_name %></td>
        <td class="numeric"><%= result.price %></td>
        <td class="numeric"><%= result.quantity %></td>
        <td><%= result.adjust.unit %></td>
        <td class="numeric"><%= result.amount %></td>
      </tr>
      <% home_amount += result.model.amount %>
      <% total_amount += result.model.amount %>
      <% old_owner = result.model.owner %>
    <% end %>
    <tr class="<%= even ? 'even_color' : 'odd_color' %>">
      <td><%= old_owner.name if old_owner %></td>
      <td colspan="7">合計</td>
      <td class="numeric"><%= number_to_currency(home_amount, {precision: 0, unit: ""}) %></td>
    </tr>
  <tbody>
  <tfoot>
    <th colspan="8">総合計</th>
    <td class="numeric"><%= number_to_currency(total_amount, {precision: 0, unit: ""}) %></td>
  </tfoot>
</table>
<%= button_tag "戻る",  type: :button, :onclick => raw("location.href = '" + (params[:fixed_at] ? fixes_path : root_path) + "';") %>
