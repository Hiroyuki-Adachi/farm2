<h1>世帯別作業一覧</h1>
<%= button_tag "戻る",  type: :button, :onclick => raw("javascript:location.href = '" + root_path + "';") %>
<%= stylesheet_link_tag 'work-lists', :media => 'all' %>
<table class="list">
  <tbody>
    <tr>
      <th>世帯</th>
      <th>作業者</th>
      <th>作業日</th>
      <th>作業種別</th>
      <th>作業内容</th>
      <th>作業時間</th>
      <th>単価</th>
      <th>日当</th>
    </tr>
<% worker_hours = 0.0 %>
<% home_hours = 0.0 %>
<% worker_amount = 0 %>
<% home_amount = 0 %>
<% even = false %>
<% @results.each_with_index do |result, i| %>
<%   amount = result.model.work.work_kind.term_price(@term) * result.model.hours %>
    <tr class="<%= even ? 'even_color' : 'odd_color' %>">
      <td><%= result.home_name %></td>
      <td><%= result.worker.name %></td>
      <td><%= result.worked_at %></td>
      <td><%= result.work_type_name %></td>
      <td style="overflow:hidden;"><%= result.work_name %></td>
      <td class="numeric"><%= result.hours %></td>
      <td class="numeric"><%= result.price(@term) %></td>
      <td class="numeric"><%= number_to_currency(amount, {precision: 0, unit: ""}) %></td>
    </tr>
<% worker_hours += result.model.hours %>
<% home_hours   += result.model.hours %>
<% worker_amount += amount %>
<% home_amount   += amount %>
<%  if i  < @results.count - 1 %>
<%    unless @results[i + 1].worker_id == result.worker_id %>
        <tr class="<%= even ? 'even_color' : 'odd_color' %>">
          <td><%= result.home_name %></td>
          <td><%= result.worker.name %></td>
          <td colspan="3">合計</td>
          <td class="numeric"><%=h sprintf("%.1f", worker_hours) %></td>
          <td colspan="2" class="numeric"><%=h number_with_delimiter(worker_amount.to_i, {:precision => 0}) %></td>
        </tr>
<%      worker_hours = 0.0 %>
<%      worker_amount = 0 %>
<%    end %>
<%    unless @results[i + 1].worker.home_id == result.worker.home_id %>
        <tr class="<%= even ? 'even_color' : 'odd_color' %>">
          <td><%= result.home_name %></td>
          <td colspan="4">合計</td>
          <td class="numeric"><%=h sprintf("%.1f", home_hours) %></td>
          <td colspan="2" class="numeric"><%=h number_with_delimiter(home_amount.to_i, {:precision => 0}) %></td>
        </tr>
        <tr class="middle_header">
          <th>世帯</th>
          <th>作業者</th>
          <th>作業日</th>
          <th>作業種別</th>
          <th>作業内容</th>
          <th>作業時間</th>
        </tr>
<%      home_hours = 0.0 %>
<%      home_amount = 0 %>
<%      even = !even%>
<%    end %>
<%  end %>
<% end %>
<% if @results.count > 0 %>
    <tr class="<%= even ? 'even_color' : 'odd_color' %>">
      <td><%=h @results.last.home_name %></td>
      <td><%=h @results.last.worker.name %></td>
      <td colspan="3">合計</td>
      <td class="numeric"><%=h sprintf("%.1f", worker_hours) %></td>
      <td colspan="2" class="numeric"><%=h number_with_delimiter(worker_amount.to_i, {:precision => 0}) %></td>
    </tr>
    <tr class="<%= even ? 'even_color' : 'odd_color' %>">
      <td><%=h @results.last.home_name %></td>
      <td colspan="4">合計</td>
      <td class="numeric"><%=h sprintf("%.1f", home_hours) %></td>
      <td colspan="2" class="numeric"><%=h number_with_delimiter(home_amount.to_i, {:precision => 0}) %></td>
    </tr>
<% end %>
  </tbody>
</table>
<%= button_tag "戻る",  type: :button, :onclick => raw("javascript:location.href = '" + root_path + "';") %>
