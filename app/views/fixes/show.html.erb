<h1>確定照会</h1>

<h2><%= @fixed_at.strftime('%Y年 %m月')%>確定分</h2>

<% if @works.count > 0 %>
  <table class="table table-sm">
    <thead>
      <tr>
        <th>作業日</th>
        <th>分類</th>
        <th>内容</th>
        <th style="text-align:right;">人数</th>
        <th style="text-align:right;">工数</th>
        <th style="text-align:right;">日当</th>
        <th style="text-align:right;">機械使用料</th>
      </tr>
    </thead>
    <tbody id="tbody_works">
    <% sum_workers_count = 0 %>
    <% sum_hours = 0 %>
    <% sum_workers_amount = 0 %>
    <% sum_machines_amount = 0 %>
    <% @works.each do |work| %>
        <tr>
          <td><%=h work.worked_at %></td>
          <td><%=h work.genre_name %></td>
          <td><%=h work.name %></td>
          <td class="numeric"><%= work.workers_count %></td>
          <td class="numeric"><%= work.sum_hours %></td>
          <td class="numeric"><%= work.sum_workers_amount %></td>
          <td class="numeric"><%= work.sum_machines_amount %></td>
        </tr>
        <% sum_workers_count += work.model.workers_count %>
        <% sum_hours += work.model.sum_hours %>
        <% sum_workers_amount += work.model.sum_workers_amount %>
        <% sum_machines_amount += work.model.sum_machines_amount %>
    <% end %>
    </tbody>
    <tfoot>
      <tr>
        <th colspan="3">合計</th>
        <td class="numeric"><%= sum_workers_count %></td>
        <td class="numeric"><%= "%.1f"%sum_hours %></td>
        <td class="numeric"><%= number_to_currency(sum_workers_amount, {precision: 0, unit: ""})%></td>
        <td class="numeric"><%= number_to_currency(sum_machines_amount, {precision: 0, unit: ""})%></td>
      </tr>
    </tfoot>
  </table>
<% end %>
<%= button_tag "戻る",  type: :button, onclick: raw("javascript:location.href = '" + fixes_path + "';"), class: "btn btn-outline-dark" %>
