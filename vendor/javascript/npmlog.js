import*as e from"are-we-there-yet";import*as t from"gauge";import*as r from"events";import*as i from"util";import*as s from"set-blocking";import*as a from"console-control-strings";import n from"process";var l="default"in e?e.default:e;var o="default"in t?t.default:t;var h="default"in r?r.default:r;var f="default"in i?i.default:i;var u="default"in s?s.default:s;var g="default"in a?a.default:a;var d={};var c=n;var v=l;var p=o;var b=h.EventEmitter;var m=d=d=new b;var y=f;var w=u;var k=g;w(true);var E=c.stderr;Object.defineProperty(m,"stream",{set:function(e){E=e;this.gauge&&this.gauge.setWriteTo(E,E)},get:function(){return E}});var x;m.useColor=function(){return null!=x?x:E.isTTY};m.enableColor=function(){x=true;this.gauge.setTheme({hasColor:x,hasUnicode:C})};m.disableColor=function(){x=false;this.gauge.setTheme({hasColor:x,hasUnicode:C})};m.level="info";m.gauge=new p(E,{enabled:false,theme:{hasColor:m.useColor()},template:[{type:"progressbar",length:20},{type:"activityIndicator",kerning:1,length:1},{type:"section",default:""},":",{type:"logline",kerning:1,default:""}]});m.tracker=new v.TrackerGroup;m.progressEnabled=m.gauge.isEnabled();var C;m.enableUnicode=function(){C=true;this.gauge.setTheme({hasColor:this.useColor(),hasUnicode:C})};m.disableUnicode=function(){C=false;this.gauge.setTheme({hasColor:this.useColor(),hasUnicode:C})};m.setGaugeThemeset=function(e){this.gauge.setThemeset(e)};m.setGaugeTemplate=function(e){this.gauge.setTemplate(e)};m.enableProgress=function(){if(!this.progressEnabled){this.progressEnabled=true;this.tracker.on("change",this.showProgress);this._paused||this.gauge.enable()}};m.disableProgress=function(){if(this.progressEnabled){this.progressEnabled=false;this.tracker.removeListener("change",this.showProgress);this.gauge.disable()}};var L=["newGroup","newItem","newStream"];var mixinLog=function(e){Object.keys(m).forEach((function(t){if("_"!==t[0]&&!L.filter((function(e){return e===t})).length&&!e[t]&&"function"===typeof m[t]){var r=m[t];e[t]=function(){return r.apply(m,arguments)}}}));e instanceof v.TrackerGroup&&L.forEach((function(t){var r=e[t];e[t]=function(){return mixinLog(r.apply(e,arguments))}}));return e};L.forEach((function(e){m[e]=function(){return mixinLog(this.tracker[e].apply(this.tracker,arguments))}}));m.clearProgress=function(e){if(!this.progressEnabled)return e&&c.nextTick(e);this.gauge.hide(e)};m.showProgress=function(e,t){if(this.progressEnabled){var r={};e&&(r.section=e);var i=m.record[m.record.length-1];if(i){r.subsection=i.prefix;var s=m.disp[i.level]||i.level;var a=this._format(s,m.style[i.level]);i.prefix&&(a+=" "+this._format(i.prefix,this.prefixStyle));a+=" "+i.message.split(/\r?\n/)[0];r.logline=a}r.completed=t||this.tracker.completed();this.gauge.show(r)}}.bind(m);m.pause=function(){this._paused=true;this.progressEnabled&&this.gauge.disable()};m.resume=function(){if(this._paused){this._paused=false;var e=this._buffer;this._buffer=[];e.forEach((function(e){this.emitLog(e)}),this);this.progressEnabled&&this.gauge.enable()}};m._buffer=[];var T=0;m.record=[];m.maxRecordSize=1e4;m.log=function(e,t,r){var i=this.levels[e];if(void 0===i)return this.emit("error",new Error(y.format("Undefined log level: %j",e)));var s=new Array(arguments.length-2);var a=null;for(var n=2;n<arguments.length;n++){var l=s[n-2]=arguments[n];"object"===typeof l&&l instanceof Error&&l.stack&&Object.defineProperty(l,"stack",{value:a=l.stack+"",enumerable:true,writable:true})}a&&s.unshift(a+"\n");r=y.format.apply(y,s);var o={id:T++,level:e,prefix:String(t||""),message:r,messageRaw:s};this.emit("log",o);this.emit("log."+e,o);o.prefix&&this.emit(o.prefix,o);this.record.push(o);var h=this.maxRecordSize;var f=this.record.length-h;if(f>h/10){var u=Math.floor(.9*h);this.record=this.record.slice(-1*u)}this.emitLog(o)}.bind(m);m.emitLog=function(e){if(this._paused)this._buffer.push(e);else{this.progressEnabled&&this.gauge.pulse(e.prefix);var t=this.levels[e.level];if(void 0!==t&&!(t<this.levels[this.level])&&(!(t>0)||isFinite(t))){var r=null!=m.disp[e.level]?m.disp[e.level]:e.level;this.clearProgress();e.message.split(/\r?\n/).forEach((function(t){if(this.heading){this.write(this.heading,this.headingStyle);this.write(" ")}this.write(r,m.style[e.level]);var i=e.prefix||"";i&&this.write(" ");this.write(i,this.prefixStyle);this.write(" "+t+"\n")}),this);this.showProgress()}}};m._format=function(e,t){if(E){var r="";if(this.useColor()){t=t||{};var i=[];t.fg&&i.push(t.fg);t.bg&&i.push("bg"+t.bg[0].toUpperCase()+t.bg.slice(1));t.bold&&i.push("bold");t.underline&&i.push("underline");t.inverse&&i.push("inverse");i.length&&(r+=k.color(i));t.beep&&(r+=k.beep())}r+=e;this.useColor()&&(r+=k.color("reset"));return r}};m.write=function(e,t){E&&E.write(this._format(e,t))};m.addLevel=function(e,t,r,i){null==i&&(i=e);this.levels[e]=t;this.style[e]=r;this[e]||(this[e]=function(){var t=new Array(arguments.length+1);t[0]=e;for(var r=0;r<arguments.length;r++)t[r+1]=arguments[r];return this.log.apply(this,t)}.bind(this));this.disp[e]=i};m.prefixStyle={fg:"magenta"};m.headingStyle={fg:"white",bg:"black"};m.style={};m.levels={};m.disp={};m.addLevel("silly",-Infinity,{inverse:true},"sill");m.addLevel("verbose",1e3,{fg:"blue",bg:"black"},"verb");m.addLevel("info",2e3,{fg:"green"});m.addLevel("timing",2500,{fg:"green",bg:"black"});m.addLevel("http",3e3,{fg:"green",bg:"black"});m.addLevel("notice",3500,{fg:"blue",bg:"black"});m.addLevel("warn",4e3,{fg:"black",bg:"yellow"},"WARN");m.addLevel("error",5e3,{fg:"red",bg:"black"},"ERR!");m.addLevel("silent",Infinity);m.on("error",(function(){}));var _=d;export{_ as default};

