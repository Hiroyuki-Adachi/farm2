import e from"lodash/get";import n from"lodash/has";import r from"lodash/merge";import i from"lodash/uniq";import{en as s}from"make-plural";import o from"lodash/camelCase";import a from"bignumber.js";import l from"lodash/repeat";import c from"lodash/sortBy";import u from"lodash/zipObject";import p from"lodash/range";const defaultLocaleResolver=(e,n)=>{const r=[];const s=[];r.push(n);n||r.push(e.locale);e.enableFallback&&r.push(e.defaultLocale);r.filter(Boolean).map((e=>e.toString())).forEach((function(n){s.includes(n)||s.push(n);if(!e.enableFallback)return;const r=n.split("-");r.length===3&&s.push(`${r[0]}-${r[1]}`);s.push(r[0])}));return i(s)};class Locales{constructor(e){this.i18n=e;this.registry={};this.register("default",defaultLocaleResolver)}register(e,n){if(typeof n!=="function"){const e=n;n=()=>e}this.registry[e]=n}get(e){let n=this.registry[e]||this.registry[this.i18n.locale]||this.registry.default;typeof n==="function"&&(n=n(this.i18n,e));n instanceof Array||(n=[n]);return n}}function useMakePlural({pluralizer:e,includeZero:n=true,ordinal:r=false}){return function(i,s){return[n&&s===0?"zero":"",e(s,r)].filter(Boolean)}}const d=useMakePlural({pluralizer:s,includeZero:true});class Pluralization{constructor(e){this.i18n=e;this.registry={};this.register("default",d)}register(e,n){this.registry[e]=n}get(e){return this.registry[e]||this.registry[this.i18n.locale]||this.registry.default}}function camelCaseKeys(e){return e?Object.keys(e).reduce(((n,r)=>{n[o(r)]=e[r];return n}),{}):{}}function isSet(e){return e!==void 0&&e!==null}function createTranslationOptions(e,n,r){let i=[{scope:n}];isSet(r.defaults)&&(i=i.concat(r.defaults));if(isSet(r.defaultValue)){const s=typeof r.defaultValue==="function"?r.defaultValue(e,n,r):r.defaultValue;i.push({message:s});delete r.defaultValue}return i}var h;(function(e){e[e.up=a.ROUND_UP]="up";e[e.down=a.ROUND_DOWN]="down";e[e.truncate=a.ROUND_DOWN]="truncate";e[e.halfUp=a.ROUND_HALF_UP]="halfUp";e[e.default=a.ROUND_HALF_UP]="default";e[e.halfDown=a.ROUND_HALF_DOWN]="halfDown";e[e.halfEven=a.ROUND_HALF_EVEN]="halfEven";e[e.banker=a.ROUND_HALF_EVEN]="banker";e[e.ceiling=a.ROUND_CEIL]="ceiling";e[e.ceil=a.ROUND_CEIL]="ceil";e[e.floor=a.ROUND_FLOOR]="floor"})(h||(h={}));function expandRoundMode(e){var n;return(n=h[e])!==null&&n!==void 0?n:h.default}function digitCount(e){return e.isZero()?1:Math.floor(Math.log10(e.abs().toNumber())+1)}function getAbsolutePrecision(e,{precision:n,significant:r}){return r&&n!==null&&n>0?n-digitCount(e):n}function roundNumber(e,n){const r=getAbsolutePrecision(e,n);if(r===null)return e.toString();const i=expandRoundMode(n.roundMode);if(r>=0)return e.toFixed(r,i);const s=Math.pow(10,Math.abs(r));e=new a(e.div(s).toFixed(0,i)).times(s);return e.toString()}function replaceInFormat(e,{formattedNumber:n,unit:r}){return e.replace("%n",n).replace("%u",r)}function computeSignificand({significand:e,whole:n,precision:r}){if(n==="0"||r===null)return e;const i=Math.max(0,r-n.length);return(e!==null&&e!==void 0?e:"").substr(0,i)}function formatNumber(e,n){var r,i,s;const o=new a(e);if(n.raise&&!o.isFinite())throw new Error(`"${e}" is not a valid numeric value`);const c=roundNumber(o,n);const u=new a(c);const p=u.lt(0);const d=u.isZero();let[h,g]=c.split(".");const f=[];let m;const b=(r=n.format)!==null&&r!==void 0?r:"%n";const y=(i=n.negativeFormat)!==null&&i!==void 0?i:`-${b}`;const S=p&&!d?y:b;h=h.replace("-","");while(h.length>0){f.unshift(h.substr(Math.max(0,h.length-3),3));h=h.substr(0,h.length-3)}h=f.join("");m=f.join(n.delimiter);g=n.significant?computeSignificand({whole:h,significand:g,precision:n.precision}):g!==null&&g!==void 0?g:l("0",(s=n.precision)!==null&&s!==void 0?s:0);n.stripInsignificantZeros&&g&&(g=g.replace(/0+$/,""));o.isNaN()&&(m=e.toString());g&&o.isFinite()&&(m+=(n.separator||".")+g);return replaceInFormat(S,{formattedNumber:m,unit:n.unit})}function getFullScope(e,n,r){let i="";(n instanceof String||typeof n==="string")&&(i=n);n instanceof Array&&(i=n.join(e.defaultSeparator));r.scope&&(i=[r.scope,i].join(e.defaultSeparator));return i}function inferType(e){var n,r;if(e===null)return"null";const i=typeof e;return i!=="object"?i:((r=(n=e===null||e===void 0?void 0:e.constructor)===null||n===void 0?void 0:n.name)===null||r===void 0?void 0:r.toLowerCase())||"object"}function interpolate(e,n,r){r=Object.keys(r).reduce(((n,i)=>{n[e.transformKey(i)]=r[i];return n}),{});const i=n.match(e.placeholder);if(!i)return n;while(i.length){let s;const o=i.shift();const a=o.replace(e.placeholder,"$1");s=isSet(r[a])?r[a].toString().replace(/\$/gm,"_#$#_"):a in r?e.nullPlaceholder(e,o,n,r):e.missingPlaceholder(e,o,n,r);const l=new RegExp(o.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}"));n=n.replace(l,s)}return n.replace(/_#\$#_/g,"$")}function lookup(e,n,r={}){r=Object.assign({},r);const i="locale"in r?r.locale:e.locale;const s=inferType(i);const o=e.locales.get(s==="string"?i:typeof i).slice();const a=getFullScope(e,n,r).split(e.defaultSeparator).map((n=>e.transformKey(n)));const l=o.map((n=>a.reduce(((e,n)=>e&&e[n]),e.translations[n])));l.push(r.defaultValue);return l.find((e=>isSet(e)))}function numberToDelimited(e,n){const r=new a(e);if(!r.isFinite())return e.toString();if(!n.delimiterPattern.global)throw new Error(`options.delimiterPattern must be a global regular expression; received ${n.delimiterPattern}`);let[i,s]=r.toString().split(".");i=i.replace(n.delimiterPattern,(e=>`${e}${n.delimiter}`));return[i,s].filter(Boolean).join(n.separator)}const g={0:"unit",1:"ten",2:"hundred",3:"thousand",6:"million",9:"billion",12:"trillion",15:"quadrillion","-1":"deci","-2":"centi","-3":"mili","-6":"micro","-9":"nano","-12":"pico","-15":"femto"};const f=u(Object.values(g),Object.keys(g).map((e=>parseInt(e,10))));function numberToHuman(e,n,r){const i={roundMode:r.roundMode,precision:r.precision,significant:r.significant};let s;if(inferType(r.units)==="string"){const n=r.units;s=lookup(e,n);if(!s)throw new Error(`The scope "${e.locale}${e.defaultSeparator}${getFullScope(e,n,{})}" couldn't be found`)}else s=r.units;let o=roundNumber(new a(n),i);const unitExponents=e=>c(Object.keys(e).map((e=>f[e])),(e=>e*-1));const calculateExponent=(e,n)=>{const r=e.isZero()?0:Math.floor(Math.log10(e.abs().toNumber()));return unitExponents(n).find((e=>r>=e))||0};const determineUnit=(e,n)=>{const r=g[n.toString()];return e[r]||""};const l=calculateExponent(new a(o),s);const u=determineUnit(s,l);o=roundNumber(new a(o).div(Math.pow(10,l)),i);if(r.stripInsignificantZeros){let[e,n]=o.split(".");n=(n||"").replace(/0+$/,"");o=e;n&&(o+=`${r.separator}${n}`)}return r.format.replace("%n",o||"0").replace("%u",u).trim()}const m=["byte","kb","mb","gb","tb","pb","eb"];function numberToHumanSize(e,n,r){const i=expandRoundMode(r.roundMode);const s=1024;const o=new a(n).abs();const l=o.lt(s);let c;const computeExponent=(e,n)=>{const r=n.length-1;const i=new a(Math.log(e.toNumber())).div(Math.log(s)).integerValue(a.ROUND_DOWN).toNumber();return Math.min(r,i)};const storageUnitKey=e=>{const n=l?"byte":e[u];return`number.human.storage_units.units.${n}`};const u=computeExponent(o,m);c=l?o.integerValue():new a(roundNumber(o.div(Math.pow(s,u)),{significant:r.significant,precision:r.precision,roundMode:r.roundMode}));const p=e.translate("number.human.storage_units.format",{defaultValue:"%n %u"});const d=e.translate(storageUnitKey(m),{count:o.integerValue().toNumber()});let h=c.toFixed(r.precision,i);r.stripInsignificantZeros&&(h=h.replace(/(\..*?)0+$/,"$1").replace(/\.$/,""));return p.replace("%n",h).replace("%u",d)}function parseDate(e){if(e instanceof Date)return e;if(typeof e==="number"){const n=new Date;n.setTime(e);return n}const n=new String(e).match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2})(?:[.,](\d{1,3}))?)?(Z|\+00:?00)?/);if(n){const e=n.slice(1,8).map((e=>parseInt(e,10)||0));e[1]-=1;const[r,i,s,o,a,l,c]=e;const u=n[8];return u?new Date(Date.UTC(r,i,s,o,a,l,c)):new Date(r,i,s,o,a,l,c)}if(e.match(/([A-Z][a-z]{2}) ([A-Z][a-z]{2}) (\d+) (\d+:\d+:\d+) ([+-]\d+) (\d+)/)){const e=new Date;e.setTime(Date.parse([RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$6,RegExp.$4,RegExp.$5].join(" ")))}const r=new Date;r.setTime(Date.parse(e));return r}function pluralize({i18n:e,count:n,scope:r,options:i,baseScope:s}){i=Object.assign({},i);let o;let a;o=typeof r==="object"&&r?r:lookup(e,r,i);if(!o)return e.missingTranslation.get(r,i);const l=e.pluralization.get(i.locale);const c=l(e,n);const u=[];while(c.length){const e=c.shift();if(isSet(o[e])){a=o[e];break}u.push(e)}if(!isSet(a))return e.missingTranslation.get(s.split(e.defaultSeparator).concat([u[0]]),i);i.count=n;return e.interpolate(e,a,i)}const b={meridian:{am:"AM",pm:"PM"},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbrDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbrMonthNames:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};function strftime(e,n,r={}){const{abbrDayNames:i,dayNames:s,abbrMonthNames:o,monthNames:a,meridian:l}=Object.assign(Object.assign({},b),r);if(isNaN(e.getTime()))throw new Error("strftime() requires a valid date object, but received an invalid date.");const c=e.getDay();const u=e.getDate();const p=e.getFullYear();const d=e.getMonth()+1;const h=e.getHours();let g=h;const f=h>11?"pm":"am";const m=e.getSeconds();const y=e.getMinutes();const S=e.getTimezoneOffset();const _=Math.floor(Math.abs(S/60));const w=Math.abs(S)-_*60;const O=(S>0?"-":"+")+(_.toString().length<2?"0"+_:_)+(w.toString().length<2?"0"+w:w);g>12?g-=12:g===0&&(g=12);n=n.replace("%a",i[c]);n=n.replace("%A",s[c]);n=n.replace("%b",o[d]);n=n.replace("%B",a[d]);n=n.replace("%d",u.toString().padStart(2,"0"));n=n.replace("%e",u.toString());n=n.replace("%-d",u.toString());n=n.replace("%H",h.toString().padStart(2,"0"));n=n.replace("%-H",h.toString());n=n.replace("%k",h.toString());n=n.replace("%I",g.toString().padStart(2,"0"));n=n.replace("%-I",g.toString());n=n.replace("%l",g.toString());n=n.replace("%m",d.toString().padStart(2,"0"));n=n.replace("%-m",d.toString());n=n.replace("%M",y.toString().padStart(2,"0"));n=n.replace("%-M",y.toString());n=n.replace("%p",l[f]);n=n.replace("%P",l[f].toLowerCase());n=n.replace("%S",m.toString().padStart(2,"0"));n=n.replace("%-S",m.toString());n=n.replace("%w",c.toString());n=n.replace("%y",p.toString().padStart(2,"0").substr(-2));n=n.replace("%-y",p.toString().padStart(2,"0").substr(-2).replace(/^0+/,""));n=n.replace("%Y",p.toString());n=n.replace(/%z/i,O);return n}const within=(e,n,r)=>r>=e&&r<=n;function timeAgoInWords(e,n,r,i={}){const s=i.scope||"datetime.distance_in_words";const t=(n,r=0)=>e.t(n,{count:r,scope:s});n=parseDate(n);r=parseDate(r);let o=n.getTime()/1e3;let a=r.getTime()/1e3;o>a&&([n,r,o,a]=[r,n,a,o]);const l=Math.round(a-o);const c=Math.round((a-o)/60);const u=c/60;const d=u/24;const h=Math.round(c/60);const g=Math.round(d);const f=Math.round(g/30);if(within(0,1,c))return i.includeSeconds?within(0,4,l)?t("less_than_x_seconds",5):within(5,9,l)?t("less_than_x_seconds",10):within(10,19,l)?t("less_than_x_seconds",20):within(20,39,l)?t("half_a_minute"):within(40,59,l)?t("less_than_x_minutes",1):t("x_minutes",1):c===0?t("less_than_x_minutes",1):t("x_minutes",c);if(within(2,44,c))return t("x_minutes",c);if(within(45,89,c))return t("about_x_hours",1);if(within(90,1439,c))return t("about_x_hours",h);if(within(1440,2519,c))return t("x_days",1);if(within(2520,43199,c))return t("x_days",g);if(within(43200,86399,c))return t("about_x_months",Math.round(c/43200));if(within(86400,525599,c))return t("x_months",f);let m=n.getFullYear();n.getMonth()+1>=3&&(m+=1);let b=r.getFullYear();r.getMonth()+1<3&&(b-=1);const y=m>b?0:p(m,b).filter((e=>new Date(e,1,29).getMonth()==1)).length;const S=525600;const _=y*1440;const w=c-_;const O=Math.trunc(w/S);const M=parseFloat((w/S-O).toPrecision(3));return M<.25?t("about_x_years",O):M<.75?t("over_x_years",O):t("almost_x_years",O+1)}const guessStrategy=function(e,n){n instanceof Array&&(n=n.join(e.defaultSeparator));const r=n.split(e.defaultSeparator).slice(-1)[0];return e.missingTranslationPrefix+r.replace("_"," ").replace(/([a-z])([A-Z])/g,((e,n,r)=>`${n} ${r.toLowerCase()}`))};const messageStrategy=(e,n,r)=>{const i=getFullScope(e,n,r);const s="locale"in r?r.locale:e.locale;const o=inferType(s);const a=[o=="string"?s:o,i].join(e.defaultSeparator);return`[missing "${a}" translation]`};const errorStrategy=(e,n,r)=>{const i=getFullScope(e,n,r);const s=[e.locale,i].join(e.defaultSeparator);throw new Error(`Missing translation: ${s}`)};class MissingTranslation{constructor(e){this.i18n=e;this.registry={};this.register("guess",guessStrategy);this.register("message",messageStrategy);this.register("error",errorStrategy)}register(e,n){this.registry[e]=n}get(e,n){var r;return this.registry[(r=n.missingBehavior)!==null&&r!==void 0?r:this.i18n.missingBehavior](this.i18n,e,n)}}var y=(void 0,function(e,n,r,i){function adopt(e){return e instanceof r?e:new r((function(n){n(e)}))}return new(r||(r=Promise))((function(r,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((i=i.apply(e,n||[])).next())}))});const S={defaultLocale:"en",availableLocales:["en"],locale:"en",defaultSeparator:".",placeholder:/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,enableFallback:false,missingBehavior:"message",missingTranslationPrefix:"",missingPlaceholder:(e,n)=>`[missing "${n}" value]`,nullPlaceholder:(e,n,r,i)=>e.missingPlaceholder(e,n,r,i),transformKey:e=>e};class I18n{constructor(e={},n={}){this._locale=S.locale;this._defaultLocale=S.defaultLocale;this._version=0;this.onChangeHandlers=[];this.translations={};this.availableLocales=[];this.t=this.translate;this.p=this.pluralize;this.l=this.localize;this.distanceOfTimeInWords=this.timeAgoInWords;const{locale:r,enableFallback:i,missingBehavior:s,missingTranslationPrefix:o,missingPlaceholder:a,nullPlaceholder:l,defaultLocale:c,defaultSeparator:u,placeholder:p,transformKey:d}=Object.assign(Object.assign({},S),n);this.locale=r;this.defaultLocale=c;this.defaultSeparator=u;this.enableFallback=i;this.locale=r;this.missingBehavior=s;this.missingTranslationPrefix=o;this.missingPlaceholder=a;this.nullPlaceholder=l;this.placeholder=p;this.pluralization=new Pluralization(this);this.locales=new Locales(this);this.missingTranslation=new MissingTranslation(this);this.transformKey=d;this.interpolate=interpolate;this.store(e)}store(e){r(this.translations,e);this.hasChanged()}get locale(){return this._locale||this.defaultLocale||"en"}set locale(e){if(typeof e!=="string")throw new Error(`Expected newLocale to be a string; got ${inferType(e)}`);const n=this._locale!==e;this._locale=e;n&&this.hasChanged()}get defaultLocale(){return this._defaultLocale||"en"}set defaultLocale(e){if(typeof e!=="string")throw new Error(`Expected newLocale to be a string; got ${inferType(e)}`);const n=this._defaultLocale!==e;this._defaultLocale=e;n&&this.hasChanged()}translate(e,n){n=Object.assign({},n);const r=createTranslationOptions(this,e,n);let i;const s=r.some((e=>{isSet(e.scope)?i=lookup(this,e.scope,n):isSet(e.message)&&(i=e.message);return i!==void 0&&i!==null}));if(!s)return this.missingTranslation.get(e,n);typeof i==="string"?i=this.interpolate(this,i,n):typeof i==="object"&&i&&isSet(n.count)&&(i=pluralize({i18n:this,count:n.count||0,scope:i,options:n,baseScope:getFullScope(this,e,n)}));n&&i instanceof Array&&(i=i.map((e=>typeof e==="string"?interpolate(this,e,n):e)));return i}pluralize(e,n,r){return pluralize({i18n:this,count:e,scope:n,options:Object.assign({},r),baseScope:getFullScope(this,n,r!==null&&r!==void 0?r:{})})}localize(e,n,r){r=Object.assign({},r);if(n===void 0||n===null)return"";switch(e){case"currency":return this.numberToCurrency(n);case"number":return formatNumber(n,Object.assign({delimiter:",",precision:3,separator:".",significant:false,stripInsignificantZeros:false},lookup(this,"number.format")));case"percentage":return this.numberToPercentage(n);default:{let i;i=e.match(/^(date|time)/)?this.toTime(e,n):n.toString();return interpolate(this,i,r)}}}toTime(e,n){const r=parseDate(n);const i=lookup(this,e);return r.toString().match(/invalid/i)?r.toString():i?this.strftime(r,i):r.toString()}numberToCurrency(e,n={}){return formatNumber(e,Object.assign(Object.assign(Object.assign({delimiter:",",format:"%u%n",precision:2,separator:".",significant:false,stripInsignificantZeros:false,unit:"$"},camelCaseKeys(this.get("number.format"))),camelCaseKeys(this.get("number.currency.format"))),n))}numberToPercentage(e,n={}){return formatNumber(e,Object.assign(Object.assign(Object.assign({delimiter:"",format:"%n%",precision:3,stripInsignificantZeros:false,separator:".",significant:false},camelCaseKeys(this.get("number.format"))),camelCaseKeys(this.get("number.percentage.format"))),n))}numberToHumanSize(e,n={}){return numberToHumanSize(this,e,Object.assign(Object.assign(Object.assign({delimiter:"",precision:3,significant:true,stripInsignificantZeros:true,units:{billion:"Billion",million:"Million",quadrillion:"Quadrillion",thousand:"Thousand",trillion:"Trillion",unit:""}},camelCaseKeys(this.get("number.human.format"))),camelCaseKeys(this.get("number.human.storage_units"))),n))}numberToHuman(e,n={}){return numberToHuman(this,e,Object.assign(Object.assign(Object.assign({delimiter:"",separator:".",precision:3,significant:true,stripInsignificantZeros:true,format:"%n %u",roundMode:"default",units:{billion:"Billion",million:"Million",quadrillion:"Quadrillion",thousand:"Thousand",trillion:"Trillion",unit:""}},camelCaseKeys(this.get("number.human.format"))),camelCaseKeys(this.get("number.human.decimal_units"))),n))}numberToRounded(e,n){return formatNumber(e,Object.assign({unit:"",precision:3,significant:false,separator:".",delimiter:"",stripInsignificantZeros:false},n))}numberToDelimited(e,n={}){return numberToDelimited(e,Object.assign({delimiterPattern:/(\d)(?=(\d\d\d)+(?!\d))/g,delimiter:",",separator:"."},n))}withLocale(e,n){return y(this,void 0,void 0,(function*(){const r=this.locale;try{this.locale=e;yield n()}finally{this.locale=r}}))}strftime(e,n,r={}){return strftime(e,n,Object.assign(Object.assign(Object.assign({},camelCaseKeys(lookup(this,"date"))),{meridian:{am:lookup(this,"time.am")||"AM",pm:lookup(this,"time.pm")||"PM"}}),r))}update(r,i,s={strict:false}){if(s.strict&&!n(this.translations,r))throw new Error(`The path "${r}" is not currently defined`);const o=e(this.translations,r);const a=inferType(o);const l=inferType(i);if(s.strict&&a!==l)throw new Error(`The current type for "${r}" is "${a}", but you're trying to override it with "${l}"`);let c;c=l==="object"?Object.assign(Object.assign({},o),i):i;const u=r.split(this.defaultSeparator);const p=u.pop();let d=this.translations;for(const e of u){d[e]||(d[e]={});d=d[e]}d[p]=c;this.hasChanged()}toSentence(e,n={}){const{wordsConnector:r,twoWordsConnector:i,lastWordConnector:s}=Object.assign(Object.assign({wordsConnector:", ",twoWordsConnector:" and ",lastWordConnector:", and "},camelCaseKeys(lookup(this,"support.array"))),n);const o=e.length;switch(o){case 0:return"";case 1:return`${e[0]}`;case 2:return e.join(i);default:return[e.slice(0,o-1).join(r),s,e[o-1]].join("")}}timeAgoInWords(e,n,r={}){return timeAgoInWords(this,e,n,r)}onChange(e){this.onChangeHandlers.push(e);return()=>{this.onChangeHandlers.splice(this.onChangeHandlers.indexOf(e),1)}}get version(){return this._version}formatNumber(e,n={}){n=Object.assign(Object.assign({delimiter:",",precision:3,separator:".",unit:"",format:"%u%n",significant:false,stripInsignificantZeros:false},camelCaseKeys(this.get("number.format"))),n);return formatNumber(e,n)}get(e){return lookup(this,e)}runCallbacks(){this.onChangeHandlers.forEach((e=>e(this)))}hasChanged(){this._version+=1;this.runCallbacks()}}export{I18n,Locales,MissingTranslation,Pluralization,useMakePlural};

