import*as e from"assert";import t from"./signals.js";import*as i from"events";import"process";var n="default"in e?e.default:e;var r="default"in i?i.default:i;var o="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var a={};var l=o.process;const processOk=function(e){return e&&"object"===typeof e&&"function"===typeof e.removeListener&&"function"===typeof e.emit&&"function"===typeof e.reallyExit&&"function"===typeof e.listeners&&"function"===typeof e.kill&&"number"===typeof e.pid&&"function"===typeof e.on};if(processOk(l)){var f=n;var s=t;var u=/^win/i.test(l.platform);var c=r;"function"!==typeof c&&(c=c.EventEmitter);var p;if(l.__signal_exit_emitter__)p=l.__signal_exit_emitter__;else{p=l.__signal_exit_emitter__=new c;p.count=0;p.emitted={}}if(!p.infinite){p.setMaxListeners(Infinity);p.infinite=true}a=function(e,t){if(!processOk(o.process))return function(){};f.equal(typeof e,"function","a callback must be provided for exit handler");false===m&&y();var i="exit";t&&t.alwaysLast&&(i="afterexit");var remove=function(){p.removeListener(i,e);0===p.listeners("exit").length&&0===p.listeners("afterexit").length&&d()};p.on(i,e);return remove};var d=function unload(){if(m&&processOk(o.process)){m=false;s.forEach((function(e){try{l.removeListener(e,x[e])}catch(e){}}));l.emit=h;l.reallyExit=_;p.count-=1}};a.unload=d;var v=function emit(e,t,i){if(!p.emitted[e]){p.emitted[e]=true;p.emit(e,t,i)}};var x={};s.forEach((function(e){x[e]=function listener(){if(processOk(o.process)){var t=l.listeners(e);if(t.length===p.count){d();v("exit",null,e);v("afterexit",null,e);u&&"SIGHUP"===e&&(e="SIGINT");l.kill(l.pid,e)}}}}));a.signals=function(){return s};var m=false;var y=function load(){if(!m&&processOk(o.process)){m=true;p.count+=1;s=s.filter((function(e){try{l.on(e,x[e]);return true}catch(e){return false}}));l.emit=E;l.reallyExit=g}};a.load=y;var _=l.reallyExit;var g=function processReallyExit(e){if(processOk(o.process)){l.exitCode=e||0;v("exit",l.exitCode,null);v("afterexit",l.exitCode,null);_.call(l,l.exitCode)}};var h=l.emit;var E=function processEmit(e,t){if("exit"===e&&processOk(o.process)){void 0!==t&&(l.exitCode=t);var i=h.apply(this||o,arguments);v("exit",l.exitCode,null);v("afterexit",l.exitCode,null);return i}return h.apply(this||o,arguments)}}else a=function(){return function(){}};var b=a;const C=a.unload,L=a.signals,I=a.load;export{b as default,I as load,L as signals,C as unload};

