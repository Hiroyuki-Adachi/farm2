import{b as e}from"../../_/8dc3f476.js";import t from"./assert.js";import"./util.js";import{X as r}from"../../_/57403c48.js";import"./path.js";import{p as n}from"../../_/e0803811.js";import"./events.js";import{y as o}from"../../_/8ddf35de.js";import"./stream.js";import i,{fileURLToPath as a}from"./url.js";import{e as s}from"../../_/c5b352d6.js";import{e as u}from"../../_/9e083af2.js";import{Buffer as c}from"./buffer.js";import"../../_/a421dfba.js";import"../../_/633ae550.js";import"../../_/cb95b980.js";import"../../_/0545670c.js";import"../../_/3fe460d2.js";var f={},l=false;function dew$f(){if(l)return f;l=true;Object.defineProperty(f,"__esModule",{value:true});f.constants=void 0;f.constants={O_RDONLY:0,O_WRONLY:1,O_RDWR:2,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,UV_FS_COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_EXCL:1,COPYFILE_FICLONE:2,COPYFILE_FICLONE_FORCE:4};return f}var p={},d=false;function dew$e(){if(d)return p;d=true;"function"===typeof BigInt?p.default=BigInt:p.default=function BigIntNotSupported(){throw new Error("BigInt is not supported in this environment.")};return p}var h={},m=false;function dew$d(){if(m)return h;m=true;Object.defineProperty(h,"__esModule",{value:true});h.Stats=void 0;var e=dew$f();var t=dew$e();var r=e.constants.S_IFMT,n=e.constants.S_IFDIR,o=e.constants.S_IFREG,i=e.constants.S_IFBLK,a=e.constants.S_IFCHR,s=e.constants.S_IFLNK,u=e.constants.S_IFIFO,c=e.constants.S_IFSOCK;var f=function(){function Stats(){}Stats.build=function(e,r){void 0===r&&(r=false);var n=new Stats;var o=e.uid,i=e.gid,a=e.atime,s=e.mtime,u=e.ctime;var c=r?t.default:function(e){return e};n.uid=c(o);n.gid=c(i);n.rdev=c(0);n.blksize=c(4096);n.ino=c(e.ino);n.size=c(e.getSize());n.blocks=c(1);n.atime=a;n.mtime=s;n.ctime=u;n.birthtime=u;n.atimeMs=c(a.getTime());n.mtimeMs=c(s.getTime());var f=c(u.getTime());n.ctimeMs=f;n.birthtimeMs=f;n.dev=c(0);n.mode=c(e.mode);n.nlink=c(e.nlink);return n};Stats.prototype._checkModeProperty=function(e){return(Number(this.mode)&r)===e};Stats.prototype.isDirectory=function(){return this._checkModeProperty(n)};Stats.prototype.isFile=function(){return this._checkModeProperty(o)};Stats.prototype.isBlockDevice=function(){return this._checkModeProperty(i)};Stats.prototype.isCharacterDevice=function(){return this._checkModeProperty(a)};Stats.prototype.isSymbolicLink=function(){return this._checkModeProperty(s)};Stats.prototype.isFIFO=function(){return this._checkModeProperty(u)};Stats.prototype.isSocket=function(){return this._checkModeProperty(c)};return Stats}();h.Stats=f;h.default=f;return h}var y={},v=false;function dew$c(){if(v)return y;v=true;var t=y&&y.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)if(n||!(o in t)){n||(n=Array.prototype.slice.call(t,0,o));n[o]=t[o]}return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(y,"__esModule",{value:true});y.bufferFrom=y.bufferAllocUnsafe=y.Buffer=void 0;var r=e;Object.defineProperty(y,"Buffer",{enumerable:true,get:function(){return r.Buffer}});function bufferV0P12Ponyfill(e){var n=[];for(var o=1;o<arguments.length;o++)n[o-1]=arguments[o];return new(r.Buffer.bind.apply(r.Buffer,t([void 0,e],n,false)))}var n=r.Buffer.allocUnsafe||bufferV0P12Ponyfill;y.bufferAllocUnsafe=n;var o=r.Buffer.from||bufferV0P12Ponyfill;y.bufferFrom=o;return y}var S={},_=false;var g="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;function dew$b(){if(_)return S;_=true;var e=S&&S.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};return extendStatics(e,t)};return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(S,"__esModule",{value:true});S.E=S.AssertionError=S.message=S.RangeError=S.TypeError=S.Error=void 0;var n=t;var o=r;var i="undefined"===typeof Symbol?"_kCode":Symbol("code");var a={};function makeNodeError(t){return function(t){e(NodeError,t);function NodeError(e){var r=[];for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=t.call(this,message(e,r))||this;o.code=e;o[i]=e;o.name=t.prototype.name+" ["+o[i]+"]";return o}return NodeError}(t)}var s="undefined"!==typeof globalThis?globalThis:g;var u=function(t){e(AssertionError,t);function AssertionError(e){var r=this;if("object"!==typeof e||null===e)throw new S.TypeError("ERR_INVALID_ARG_TYPE","options","object");r=e.message?t.call(this,e.message)||this:t.call(this,o.inspect(e.actual).slice(0,128)+" "+e.operator+" "+o.inspect(e.expected).slice(0,128))||this;r.generatedMessage=!e.message;r.name="AssertionError [ERR_ASSERTION]";r.code="ERR_ASSERTION";r.actual=e.actual;r.expected=e.expected;r.operator=e.operator;S.Error.captureStackTrace(r,e.stackStartFunction);return r}return AssertionError}(s.Error);S.AssertionError=u;function message(e,t){n.strictEqual(typeof e,"string");var r=a[e];n(r,"An invalid error message key was used: "+e+".");var i;if("function"===typeof r)i=r;else{i=o.format;if(void 0===t||0===t.length)return r;t.unshift(r)}return String(i.apply(null,t))}S.message=message;function E(e,t){a[e]="function"===typeof t?t:String(t)}S.E=E;S.Error=makeNodeError(s.Error);S.TypeError=makeNodeError(s.TypeError);S.RangeError=makeNodeError(s.RangeError);E("ERR_ARG_NOT_ITERABLE","%s must be iterable");E("ERR_ASSERTION","%s");E("ERR_BUFFER_OUT_OF_BOUNDS",bufferOutOfBounds);E("ERR_CHILD_CLOSED_BEFORE_REPLY","Child closed before reply received");E("ERR_CONSOLE_WRITABLE_STREAM","Console expects a writable stream instance for %s");E("ERR_CPU_USAGE","Unable to obtain cpu usage %s");E("ERR_DNS_SET_SERVERS_FAILED",(function(e,t){return'c-ares failed to set servers: "'+e+'" ['+t+"]"}));E("ERR_FALSY_VALUE_REJECTION","Promise was rejected with falsy value");E("ERR_ENCODING_NOT_SUPPORTED",(function(e){return'The "'+e+'" encoding is not supported'}));E("ERR_ENCODING_INVALID_ENCODED_DATA",(function(e){return"The encoded data was not valid for encoding "+e}));E("ERR_HTTP_HEADERS_SENT","Cannot render headers after they are sent to the client");E("ERR_HTTP_INVALID_STATUS_CODE","Invalid status code: %s");E("ERR_HTTP_TRAILER_INVALID","Trailers are invalid with this transfer encoding");E("ERR_INDEX_OUT_OF_RANGE","Index out of range");E("ERR_INVALID_ARG_TYPE",invalidArgType);E("ERR_INVALID_ARRAY_LENGTH",(function(e,t,r){n.strictEqual(typeof r,"number");return'The array "'+e+'" (length '+r+") must be of length "+t+"."}));E("ERR_INVALID_BUFFER_SIZE","Buffer size must be a multiple of %s");E("ERR_INVALID_CALLBACK","Callback must be a function");E("ERR_INVALID_CHAR","Invalid character in %s");E("ERR_INVALID_CURSOR_POS","Cannot set cursor row without setting its column");E("ERR_INVALID_FD",'"fd" must be a positive integer: %s');E("ERR_INVALID_FILE_URL_HOST",'File URL host must be "localhost" or empty on %s');E("ERR_INVALID_FILE_URL_PATH","File URL path %s");E("ERR_INVALID_HANDLE_TYPE","This handle type cannot be sent");E("ERR_INVALID_IP_ADDRESS","Invalid IP address: %s");E("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+String(t)+'" is invalid for option "'+e+'"'}));E("ERR_INVALID_OPT_VALUE_ENCODING",(function(e){return'The value "'+String(e)+'" is invalid for option "encoding"'}));E("ERR_INVALID_REPL_EVAL_CONFIG",'Cannot specify both "breakEvalOnSigint" and "eval" for REPL');E("ERR_INVALID_SYNC_FORK_INPUT","Asynchronous forks do not support Buffer, Uint8Array or string input: %s");E("ERR_INVALID_THIS",'Value of "this" must be of type %s');E("ERR_INVALID_TUPLE","%s must be an iterable %s tuple");E("ERR_INVALID_URL","Invalid URL: %s");E("ERR_INVALID_URL_SCHEME",(function(e){return"The URL must be "+oneOf(e,"scheme")}));E("ERR_IPC_CHANNEL_CLOSED","Channel closed");E("ERR_IPC_DISCONNECTED","IPC channel is already disconnected");E("ERR_IPC_ONE_PIPE","Child process can have only one IPC pipe");E("ERR_IPC_SYNC_FORK","IPC cannot be used with synchronous forks");E("ERR_MISSING_ARGS",missingArgs);E("ERR_MULTIPLE_CALLBACK","Callback called multiple times");E("ERR_NAPI_CONS_FUNCTION","Constructor must be a function");E("ERR_NAPI_CONS_PROTOTYPE_OBJECT","Constructor.prototype must be an object");E("ERR_NO_CRYPTO","Node.js is not compiled with OpenSSL crypto support");E("ERR_NO_LONGER_SUPPORTED","%s is no longer supported");E("ERR_PARSE_HISTORY_DATA","Could not parse history data in %s");E("ERR_SOCKET_ALREADY_BOUND","Socket is already bound");E("ERR_SOCKET_BAD_PORT","Port should be > 0 and < 65536");E("ERR_SOCKET_BAD_TYPE","Bad socket type specified. Valid types are: udp4, udp6");E("ERR_SOCKET_CANNOT_SEND","Unable to send data");E("ERR_SOCKET_CLOSED","Socket is closed");E("ERR_SOCKET_DGRAM_NOT_RUNNING","Not running");E("ERR_STDERR_CLOSE","process.stderr cannot be closed");E("ERR_STDOUT_CLOSE","process.stdout cannot be closed");E("ERR_STREAM_WRAP","Stream has StringDecoder set or is in objectMode");E("ERR_TLS_CERT_ALTNAME_INVALID","Hostname/IP does not match certificate's altnames: %s");E("ERR_TLS_DH_PARAM_SIZE",(function(e){return"DH parameter size "+e+" is less than 2048"}));E("ERR_TLS_HANDSHAKE_TIMEOUT","TLS handshake timeout");E("ERR_TLS_RENEGOTIATION_FAILED","Failed to renegotiate");E("ERR_TLS_REQUIRED_SERVER_NAME",'"servername" is required parameter for Server.addContext');E("ERR_TLS_SESSION_ATTACK","TSL session renegotiation attack detected");E("ERR_TRANSFORM_ALREADY_TRANSFORMING","Calling transform done when still transforming");E("ERR_TRANSFORM_WITH_LENGTH_0","Calling transform done when writableState.length != 0");E("ERR_UNKNOWN_ENCODING","Unknown encoding: %s");E("ERR_UNKNOWN_SIGNAL","Unknown signal: %s");E("ERR_UNKNOWN_STDIN_TYPE","Unknown stdin file type");E("ERR_UNKNOWN_STREAM_TYPE","Unknown stream file type");E("ERR_V8BREAKITERATOR","Full ICU data not installed. See https://github.com/nodejs/node/wiki/Intl");function invalidArgType(e,t,r){n(e,"name is required");var o;if(t.includes("not ")){o="must not be";t=t.split("not ")[1]}else o="must be";var i;if(Array.isArray(e)){var a=e.map((function(e){return'"'+e+'"'})).join(", ");i="The "+a+" arguments "+o+" "+oneOf(t,"type")}else if(e.includes(" argument"))i="The "+e+" "+o+" "+oneOf(t,"type");else{var s=e.includes(".")?"property":"argument";i='The "'+e+'" '+s+" "+o+" "+oneOf(t,"type")}arguments.length>=3&&(i+=". Received type "+(null!==r?typeof r:"null"));return i}function missingArgs(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];n(e.length>0,"At least one arg needs to be specified");var r="The ";var o=e.length;e=e.map((function(e){return'"'+e+'"'}));switch(o){case 1:r+=e[0]+" argument";break;case 2:r+=e[0]+" and "+e[1]+" arguments";break;default:r+=e.slice(0,o-1).join(", ");r+=", and "+e[o-1]+" arguments";break}return r+" must be specified"}function oneOf(e,t){n(e,"expected is required");n("string"===typeof t,"thing is required");if(Array.isArray(e)){var r=e.length;n(r>0,"At least one expected value needs to be specified");e=e.map((function(e){return String(e)}));return r>2?"one of "+t+" "+e.slice(0,r-1).join(", ")+", or "+e[r-1]:2===r?"one of "+t+" "+e[0]+" or "+e[1]:"of "+t+" "+e[0]}return"of "+t+" "+String(e)}function bufferOutOfBounds(e,t){return t?"Attempt to write outside buffer bounds":'"'+e+'" is outside of buffer bounds'}return S}var F={},w=false;function dew$a(){if(w)return F;w=true;Object.defineProperty(F,"__esModule",{value:true});F.strToEncoding=F.assertEncoding=F.ENCODING_UTF8=void 0;var e=dew$c();var t=dew$b();F.ENCODING_UTF8="utf8";function assertEncoding(r){if(r&&!e.Buffer.isEncoding(r))throw new t.TypeError("ERR_INVALID_OPT_VALUE_ENCODING",r)}F.assertEncoding=assertEncoding;function strToEncoding(t,r){return r&&r!==F.ENCODING_UTF8?"buffer"===r?new e.Buffer(t):new e.Buffer(t).toString(r):t}F.strToEncoding=strToEncoding;return F}var T={},b=false;function dew$9(){if(b)return T;b=true;Object.defineProperty(T,"__esModule",{value:true});T.Dirent=void 0;var e=dew$f();var t=dew$a();var r=e.constants.S_IFMT,n=e.constants.S_IFDIR,o=e.constants.S_IFREG,i=e.constants.S_IFBLK,a=e.constants.S_IFCHR,s=e.constants.S_IFLNK,u=e.constants.S_IFIFO,c=e.constants.S_IFSOCK;var f=function(){function Dirent(){this.name="";this.mode=0}Dirent.build=function(e,r){var n=new Dirent;var o=e.getNode().mode;n.name=(0,t.strToEncoding)(e.getName(),r);n.mode=o;return n};Dirent.prototype._checkModeProperty=function(e){return(this.mode&r)===e};Dirent.prototype.isDirectory=function(){return this._checkModeProperty(n)};Dirent.prototype.isFile=function(){return this._checkModeProperty(o)};Dirent.prototype.isBlockDevice=function(){return this._checkModeProperty(i)};Dirent.prototype.isCharacterDevice=function(){return this._checkModeProperty(a)};Dirent.prototype.isSymbolicLink=function(){return this._checkModeProperty(s)};Dirent.prototype.isFIFO=function(){return this._checkModeProperty(u)};Dirent.prototype.isSocket=function(){return this._checkModeProperty(c)};return Dirent}();T.Dirent=f;T.default=f;return T}var R={},N=false;var O="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;function dew$8(){if(N)return R;N=true;var e=n;Object.defineProperty(R,"__esModule",{value:true});var t;t="function"===typeof e.nextTick?e.nextTick.bind("undefined"!==typeof globalThis?globalThis:O):setTimeout.bind("undefined"!==typeof globalThis?globalThis:O);R.default=t;return R}var k={},I=false;function dew$7(){if(I)return k;I=true;var e=n;Object.defineProperty(k,"__esModule",{value:true});k.createProcess=void 0;var maybeReturnProcess=function(){if("undefined"!==typeof e)return e;try{return n}catch(e){return}};function createProcess(){var e=maybeReturnProcess()||{};e.getuid||(e.getuid=function(){return 0});e.getgid||(e.getgid=function(){return 0});e.cwd||(e.cwd=function(){return"/"});e.nextTick||(e.nextTick=dew$8().default);e.emitWarning||(e.emitWarning=function(e,t){console.warn(t+(t?": ":"")+e)});e.env||(e.env={});return e}k.createProcess=createProcess;k.default=createProcess();return k}var L={},A=false;function dew$6(){if(A)return L;A=true;var e=L&&L.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};return extendStatics(e,t)};return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(L,"__esModule",{value:true});L.File=L.Link=L.Node=L.SEP=void 0;var t=dew$7();var r=dew$c();var n=dew$f();var i=o;var a=dew$d();var s=n.constants.S_IFMT,u=n.constants.S_IFDIR,c=n.constants.S_IFREG,f=n.constants.S_IFLNK,l=n.constants.O_APPEND;L.SEP="/";var p=function(n){e(Node,n);function Node(e,r){void 0===r&&(r=438);var o=n.call(this)||this;o.uid=t.default.getuid();o.gid=t.default.getgid();o.atime=new Date;o.mtime=new Date;o.ctime=new Date;o.perm=438;o.mode=c;o.nlink=1;o.perm=r;o.mode|=r;o.ino=e;return o}Node.prototype.getString=function(e){void 0===e&&(e="utf8");return this.getBuffer().toString(e)};Node.prototype.setString=function(e){this.buf=(0,r.bufferFrom)(e,"utf8");this.touch()};Node.prototype.getBuffer=function(){this.buf||this.setBuffer((0,r.bufferAllocUnsafe)(0));return(0,r.bufferFrom)(this.buf)};Node.prototype.setBuffer=function(e){this.buf=(0,r.bufferFrom)(e);this.touch()};Node.prototype.getSize=function(){return this.buf?this.buf.length:0};Node.prototype.setModeProperty=function(e){this.mode=this.mode&~s|e};Node.prototype.setIsFile=function(){this.setModeProperty(c)};Node.prototype.setIsDirectory=function(){this.setModeProperty(u)};Node.prototype.setIsSymlink=function(){this.setModeProperty(f)};Node.prototype.isFile=function(){return(this.mode&s)===c};Node.prototype.isDirectory=function(){return(this.mode&s)===u};Node.prototype.isSymlink=function(){return(this.mode&s)===f};Node.prototype.makeSymlink=function(e){this.symlink=e;this.setIsSymlink()};Node.prototype.write=function(e,t,n,o){void 0===t&&(t=0);void 0===n&&(n=e.length);void 0===o&&(o=0);this.buf||(this.buf=(0,r.bufferAllocUnsafe)(0));if(o+n>this.buf.length){var i=(0,r.bufferAllocUnsafe)(o+n);this.buf.copy(i,0,0,this.buf.length);this.buf=i}e.copy(this.buf,o,t,t+n);this.touch();return n};Node.prototype.read=function(e,t,n,o){void 0===t&&(t=0);void 0===n&&(n=e.byteLength);void 0===o&&(o=0);this.buf||(this.buf=(0,r.bufferAllocUnsafe)(0));var i=n;i>e.byteLength&&(i=e.byteLength);i+o>this.buf.length&&(i=this.buf.length-o);this.buf.copy(e,t,o,o+i);return i};Node.prototype.truncate=function(e){void 0===e&&(e=0);if(e){this.buf||(this.buf=(0,r.bufferAllocUnsafe)(0));if(e<=this.buf.length)this.buf=this.buf.slice(0,e);else{var t=(0,r.bufferAllocUnsafe)(0);this.buf.copy(t);t.fill(0,e)}}else this.buf=(0,r.bufferAllocUnsafe)(0);this.touch()};Node.prototype.chmod=function(e){this.perm=e;this.mode=-512&this.mode|e;this.touch()};Node.prototype.chown=function(e,t){this.uid=e;this.gid=t;this.touch()};Node.prototype.touch=function(){this.mtime=new Date;this.emit("change",this)};Node.prototype.canRead=function(e,r){void 0===e&&(e=t.default.getuid());void 0===r&&(r=t.default.getgid());return!!(4&this.perm)||(!!(r===this.gid&&32&this.perm)||!!(e===this.uid&&256&this.perm))};Node.prototype.canWrite=function(e,r){void 0===e&&(e=t.default.getuid());void 0===r&&(r=t.default.getgid());return!!(2&this.perm)||(!!(r===this.gid&&16&this.perm)||!!(e===this.uid&&128&this.perm))};Node.prototype.del=function(){this.emit("delete",this)};Node.prototype.toJSON=function(){return{ino:this.ino,uid:this.uid,gid:this.gid,atime:this.atime.getTime(),mtime:this.mtime.getTime(),ctime:this.ctime.getTime(),perm:this.perm,mode:this.mode,nlink:this.nlink,symlink:this.symlink,data:this.getString()}};return Node}(i.EventEmitter);L.Node=p;var d=function(t){e(Link,t);function Link(e,r,n){var o=t.call(this)||this;o.children={};o.steps=[];o.ino=0;o.length=0;o.vol=e;o.parent=r;o.steps=r?r.steps.concat([n]):[n];return o}Link.prototype.setNode=function(e){this.node=e;this.ino=e.ino};Link.prototype.getNode=function(){return this.node};Link.prototype.createChild=function(e,t){void 0===t&&(t=this.vol.createNode());var r=new Link(this.vol,this,e);r.setNode(t);t.isDirectory();this.setChild(e,r);return r};Link.prototype.setChild=function(e,t){void 0===t&&(t=new Link(this.vol,this,e));this.children[e]=t;t.parent=this;this.length++;this.emit("child:add",t,this);return t};Link.prototype.deleteChild=function(e){delete this.children[e.getName()];this.length--;this.emit("child:delete",e,this)};Link.prototype.getChild=function(e){if(Object.hasOwnProperty.call(this.children,e))return this.children[e]};Link.prototype.getPath=function(){return this.steps.join(L.SEP)};Link.prototype.getName=function(){return this.steps[this.steps.length-1]};
/**
     * Walk the tree path and return the `Link` at that location, if any.
     * @param steps {string[]} Desired location.
     * @param stop {number} Max steps to go into.
     * @param i {number} Current step in the `steps` array.
     *
     * @return {Link|null}
     */Link.prototype.walk=function(e,t,r){void 0===t&&(t=e.length);void 0===r&&(r=0);if(r>=e.length)return this;if(r>=t)return this;var n=e[r];var o=this.getChild(n);return o?o.walk(e,t,r+1):null};Link.prototype.toJSON=function(){return{steps:this.steps,ino:this.ino,children:Object.keys(this.children)}};return Link}(i.EventEmitter);L.Link=d;var h=function(){
/**
     * Open a Link-Node pair. `node` is provided separately as that might be a different node
     * rather the one `link` points to, because it might be a symlink.
     * @param link
     * @param node
     * @param flags
     * @param fd
     */
function File(e,t,r,n){this.position=0;this.link=e;this.node=t;this.flags=r;this.fd=n}File.prototype.getString=function(e){return this.node.getString()};File.prototype.setString=function(e){this.node.setString(e)};File.prototype.getBuffer=function(){return this.node.getBuffer()};File.prototype.setBuffer=function(e){this.node.setBuffer(e)};File.prototype.getSize=function(){return this.node.getSize()};File.prototype.truncate=function(e){this.node.truncate(e)};File.prototype.seekTo=function(e){this.position=e};File.prototype.stats=function(){return a.default.build(this.node)};File.prototype.write=function(e,t,r,n){void 0===t&&(t=0);void 0===r&&(r=e.length);"number"!==typeof n&&(n=this.position);this.flags&l&&(n=this.getSize());var o=this.node.write(e,t,r,n);this.position=n+o;return o};File.prototype.read=function(e,t,r,n){void 0===t&&(t=0);void 0===r&&(r=e.byteLength);"number"!==typeof n&&(n=this.position);var o=this.node.read(e,t,r,n);this.position=n+o;return o};File.prototype.chmod=function(e){this.node.chmod(e)};File.prototype.chown=function(e,t){this.node.chown(e,t)};return File}();L.File=h;return L}var V={},B=false;var C="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;function dew$5(){if(B)return V;B=true;Object.defineProperty(V,"__esModule",{value:true});function setTimeoutUnref(e,t,r){var n=setTimeout.apply("undefined"!==typeof globalThis?globalThis:C,arguments);n&&"object"===typeof n&&"function"===typeof n.unref&&n.unref();return n}V.default=setTimeoutUnref;return V}var P={},D=false;function dew$4(){if(D)return P;D=true;var e=P&&P.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)if(n||!(o in t)){n||(n=Array.prototype.slice.call(t,0,o));n[o]=t[o]}return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(P,"__esModule",{value:true});P.FileHandle=void 0;function promisify(t,r,n){void 0===n&&(n=function(e){return e});return function(){var o=[];for(var i=0;i<arguments.length;i++)o[i]=arguments[i];return new Promise((function(i,a){t[r].bind(t).apply(void 0,e(e([],o,false),[function(e,t){return e?a(e):i(n(t))}],false))}))}}var t=function(){function FileHandle(e,t){this.vol=e;this.fd=t}FileHandle.prototype.appendFile=function(e,t){return promisify(this.vol,"appendFile")(this.fd,e,t)};FileHandle.prototype.chmod=function(e){return promisify(this.vol,"fchmod")(this.fd,e)};FileHandle.prototype.chown=function(e,t){return promisify(this.vol,"fchown")(this.fd,e,t)};FileHandle.prototype.close=function(){return promisify(this.vol,"close")(this.fd)};FileHandle.prototype.datasync=function(){return promisify(this.vol,"fdatasync")(this.fd)};FileHandle.prototype.read=function(e,t,r,n){return promisify(this.vol,"read",(function(t){return{bytesRead:t,buffer:e}}))(this.fd,e,t,r,n)};FileHandle.prototype.readFile=function(e){return promisify(this.vol,"readFile")(this.fd,e)};FileHandle.prototype.stat=function(e){return promisify(this.vol,"fstat")(this.fd,e)};FileHandle.prototype.sync=function(){return promisify(this.vol,"fsync")(this.fd)};FileHandle.prototype.truncate=function(e){return promisify(this.vol,"ftruncate")(this.fd,e)};FileHandle.prototype.utimes=function(e,t){return promisify(this.vol,"futimes")(this.fd,e,t)};FileHandle.prototype.write=function(e,t,r,n){return promisify(this.vol,"write",(function(t){return{bytesWritten:t,buffer:e}}))(this.fd,e,t,r,n)};FileHandle.prototype.writeFile=function(e,t){return promisify(this.vol,"writeFile")(this.fd,e,t)};return FileHandle}();P.FileHandle=t;function createPromisesApi(e){return"undefined"===typeof Promise?null:{FileHandle:t,access:function(t,r){return promisify(e,"access")(t,r)},appendFile:function(r,n,o){return promisify(e,"appendFile")(r instanceof t?r.fd:r,n,o)},chmod:function(t,r){return promisify(e,"chmod")(t,r)},chown:function(t,r,n){return promisify(e,"chown")(t,r,n)},copyFile:function(t,r,n){return promisify(e,"copyFile")(t,r,n)},lchmod:function(t,r){return promisify(e,"lchmod")(t,r)},lchown:function(t,r,n){return promisify(e,"lchown")(t,r,n)},link:function(t,r){return promisify(e,"link")(t,r)},lstat:function(t,r){return promisify(e,"lstat")(t,r)},mkdir:function(t,r){return promisify(e,"mkdir")(t,r)},mkdtemp:function(t,r){return promisify(e,"mkdtemp")(t,r)},open:function(r,n,o){return promisify(e,"open",(function(r){return new t(e,r)}))(r,n,o)},readdir:function(t,r){return promisify(e,"readdir")(t,r)},readFile:function(r,n){return promisify(e,"readFile")(r instanceof t?r.fd:r,n)},readlink:function(t,r){return promisify(e,"readlink")(t,r)},realpath:function(t,r){return promisify(e,"realpath")(t,r)},rename:function(t,r){return promisify(e,"rename")(t,r)},rmdir:function(t){return promisify(e,"rmdir")(t)},stat:function(t,r){return promisify(e,"stat")(t,r)},symlink:function(t,r,n){return promisify(e,"symlink")(t,r,n)},truncate:function(t,r){return promisify(e,"truncate")(t,r)},unlink:function(t){return promisify(e,"unlink")(t)},utimes:function(t,r,n){return promisify(e,"utimes")(t,r,n)},writeFile:function(r,n,o){return promisify(e,"writeFile")(r instanceof t?r.fd:r,n,o)}}}P.default=createPromisesApi;return P}var U={},W=false;function dew$3(){if(W)return U;W=true;var e=n;Object.defineProperty(U,"__esModule",{value:true});U.unixify=unixify;U.correctPath=correctPath;var t="win32"===e.platform;function removeTrailingSeparator(e){var t=e.length-1;if(t<2)return e;while(isSeparator(e,t))t--;return e.substr(0,t+1)}function isSeparator(e,r){var n=e[r];return r>0&&("/"===n||t&&"\\"===n)}function normalizePath(e,t){if("string"!==typeof e)throw new TypeError("expected a string");e=e.replace(/[\\\/]+/g,"/");false!==t&&(e=removeTrailingSeparator(e));return e}function unixify(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){e=normalizePath(e,r);return e.replace(/^([a-zA-Z]+:|\.\/)/,"")}return e}function correctPath(e){return unixify(e.replace(/^\\\\\?\\.:\\/,"\\"))}return U}var M={},x=false;var j="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;function dew$2(){if(x)return M;x=true;var e=M&&M.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};return extendStatics(e,t)};return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();var t=M&&M.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)if(n||!(o in t)){n||(n=Array.prototype.slice.call(t,0,o));n[o]=t[o]}return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(M,"__esModule",{value:true});M.FSWatcher=M.StatWatcher=M.Volume=M.toUnixTimestamp=M.bufferToEncoding=M.dataToBuffer=M.dataToStr=M.pathToSteps=M.filenameToSteps=M.pathToFilename=M.flagsToNumber=M.FLAGS=void 0;var n=s;var a=dew$6();var c=dew$d();var f=dew$9();var l=dew$c();var p=dew$8();var d=dew$7();var h=dew$5();var m=u;var y=dew$f();var v=o;var S=dew$a();var _=dew$b();var g=r;var F=dew$4();var w=n.resolve;var T=y.constants.O_RDONLY,b=y.constants.O_WRONLY,R=y.constants.O_RDWR,N=y.constants.O_CREAT,O=y.constants.O_EXCL,k=y.constants.O_TRUNC,I=y.constants.O_APPEND,L=y.constants.O_SYNC,A=y.constants.O_DIRECTORY,V=y.constants.F_OK,B=y.constants.COPYFILE_EXCL,C=y.constants.COPYFILE_FICLONE_FORCE;var P=n.posix?n.posix:n,D=P.sep,U=P.relative,W=P.join,G=P.dirname;var H="win32"===d.default.platform;var K=128;var $={PATH_STR:"path must be a string or Buffer",FD:"fd must be a file descriptor",MODE_INT:"mode must be an int",CB:"callback must be a function",UID:"uid must be an unsigned int",GID:"gid must be an unsigned int",LEN:"len must be an integer",ATIME:"atime must be an integer",MTIME:"mtime must be an integer",PREFIX:"filename prefix is required",BUFFER:"buffer must be an instance of Buffer or StaticBuffer",OFFSET:"offset must be an integer",LENGTH:"length must be an integer",POSITION:"position must be an integer"};var ERRSTR_OPTS=function(e){return"Expected options to be either an object or a string, but got "+e+" instead"};var Y="ENOENT";var J="EBADF";var X="EINVAL";var q="EPERM";var z="EPROTO";var Z="EEXIST";var Q="ENOTDIR";var ee="EMFILE";var te="EACCES";var re="EISDIR";var ne="ENOTEMPTY";var oe="ENOSYS";function formatError(e,t,r,n){void 0===t&&(t="");void 0===r&&(r="");void 0===n&&(n="");var o="";r&&(o=" '"+r+"'");n&&(o+=" -> '"+n+"'");switch(e){case Y:return"ENOENT: no such file or directory, "+t+o;case J:return"EBADF: bad file descriptor, "+t+o;case X:return"EINVAL: invalid argument, "+t+o;case q:return"EPERM: operation not permitted, "+t+o;case z:return"EPROTO: protocol error, "+t+o;case Z:return"EEXIST: file already exists, "+t+o;case Q:return"ENOTDIR: not a directory, "+t+o;case re:return"EISDIR: illegal operation on a directory, "+t+o;case te:return"EACCES: permission denied, "+t+o;case ne:return"ENOTEMPTY: directory not empty, "+t+o;case ee:return"EMFILE: too many open files, "+t+o;case oe:return"ENOSYS: function not implemented, "+t+o;default:return e+": error occurred, "+t+o}}function createError(e,t,r,n,o){void 0===t&&(t="");void 0===r&&(r="");void 0===n&&(n="");void 0===o&&(o=Error);var i=new o(formatError(e,t,r,n));i.code=e;return i}var ie;(function(e){e[e.r=T]="r";e[e["r+"]=R]="r+";e[e.rs=T|L]="rs";e[e.sr=e.rs]="sr";e[e["rs+"]=R|L]="rs+";e[e["sr+"]=e["rs+"]]="sr+";e[e.w=b|N|k]="w";e[e.wx=b|N|k|O]="wx";e[e.xw=e.wx]="xw";e[e["w+"]=R|N|k]="w+";e[e["wx+"]=R|N|k|O]="wx+";e[e["xw+"]=e["wx+"]]="xw+";e[e.a=b|I|N]="a";e[e.ax=b|I|N|O]="ax";e[e.xa=e.ax]="xa";e[e["a+"]=R|I|N]="a+";e[e["ax+"]=R|I|N|O]="ax+";e[e["xa+"]=e["ax+"]]="xa+"})(ie=M.FLAGS||(M.FLAGS={}));function flagsToNumber(e){if("number"===typeof e)return e;if("string"===typeof e){var t=ie[e];if("undefined"!==typeof t)return t}throw new _.TypeError("ERR_INVALID_OPT_VALUE","flags",e)}M.flagsToNumber=flagsToNumber;function getOptions(e,t){var r;if(!t)return e;var n=typeof t;switch(n){case"string":r=Object.assign({},e,{encoding:t});break;case"object":r=Object.assign({},e,t);break;default:throw TypeError(ERRSTR_OPTS(n))}"buffer"!==r.encoding&&(0,S.assertEncoding)(r.encoding);return r}function optsGenerator(e){return function(t){return getOptions(e,t)}}function validateCallback(e){if("function"!==typeof e)throw TypeError($.CB);return e}function optsAndCbGenerator(e){return function(t,r){return"function"===typeof t?[e(),t]:[e(t),validateCallback(r)]}}var ae={encoding:"utf8"};var se=optsGenerator(ae);var ue=optsAndCbGenerator(se);var ce={flag:"r"};var fe=optsGenerator(ce);var le={encoding:"utf8",mode:438,flag:ie[ie.w]};var pe=optsGenerator(le);var de={encoding:"utf8",mode:438,flag:ie[ie.a]};var he=optsGenerator(de);var me=optsAndCbGenerator(he);var ye=ae;var ve=optsGenerator(ye);var Se=optsAndCbGenerator(ve);var _e={mode:511,recursive:false};var getMkdirOptions=function(e){return"number"===typeof e?Object.assign({},_e,{mode:e}):Object.assign({},_e,e)};var ge={recursive:false};var getRmdirOptions=function(e){return Object.assign({},ge,e)};var Ee={encoding:"utf8",withFileTypes:false};var Fe=optsGenerator(Ee);var we=optsAndCbGenerator(Fe);var Te={bigint:false};var getStatOptions=function(e){void 0===e&&(e={});return Object.assign({},Te,e)};var getStatOptsAndCb=function(e,t){return"function"===typeof e?[getStatOptions(),e]:[getStatOptions(e),validateCallback(t)]};function getPathFromURLPosix(e){if(""!==e.hostname)throw new _.TypeError("ERR_INVALID_FILE_URL_HOST",d.default.platform);var t=e.pathname;for(var r=0;r<t.length;r++)if("%"===t[r]){var n=32|t.codePointAt(r+2);if("2"===t[r+1]&&102===n)throw new _.TypeError("ERR_INVALID_FILE_URL_PATH","must not include encoded / characters")}return decodeURIComponent(t)}function pathToFilename(e){if("string"!==typeof e&&!l.Buffer.isBuffer(e)){try{if(!(e instanceof i.URL))throw new TypeError($.PATH_STR)}catch(e){throw new TypeError($.PATH_STR)}e=getPathFromURLPosix(e)}var t=String(e);nullCheck(t);return t}M.pathToFilename=pathToFilename;var resolve=function(e,t){void 0===t&&(t=d.default.cwd());return w(t,e)};if(H){var be=resolve;var Re=dew$3().unixify;resolve=function(e,t){return Re(be(e,t))}}function filenameToSteps(e,t){var r=resolve(e,t);var n=r.substr(1);return n?n.split(D):[]}M.filenameToSteps=filenameToSteps;function pathToSteps(e){return filenameToSteps(pathToFilename(e))}M.pathToSteps=pathToSteps;function dataToStr(e,t){void 0===t&&(t=S.ENCODING_UTF8);return l.Buffer.isBuffer(e)?e.toString(t):e instanceof Uint8Array?(0,l.bufferFrom)(e).toString(t):String(e)}M.dataToStr=dataToStr;function dataToBuffer(e,t){void 0===t&&(t=S.ENCODING_UTF8);return l.Buffer.isBuffer(e)?e:e instanceof Uint8Array?(0,l.bufferFrom)(e):(0,l.bufferFrom)(String(e),t)}M.dataToBuffer=dataToBuffer;function bufferToEncoding(e,t){return t&&"buffer"!==t?e.toString(t):e}M.bufferToEncoding=bufferToEncoding;function nullCheck(e,t){if(-1!==(""+e).indexOf("\0")){var r=new Error("Path must be a string without null bytes");r.code=Y;if("function"!==typeof t)throw r;d.default.nextTick(t,r);return false}return true}function _modeToNumber(e,t){return"number"===typeof e?e:"string"===typeof e?parseInt(e,8):t?modeToNumber(t):void 0}function modeToNumber(e,t){var r=_modeToNumber(e,t);if("number"!==typeof r||isNaN(r))throw new TypeError($.MODE_INT);return r}function isFd(e){return e>>>0===e}function validateFd(e){if(!isFd(e))throw TypeError($.FD)}function toUnixTimestamp(e){if("string"===typeof e&&+e==e)return+e;if(e instanceof Date)return e.getTime()/1e3;if(isFinite(e))return e<0?Date.now()/1e3:e;throw new Error("Cannot parse time: "+e)}M.toUnixTimestamp=toUnixTimestamp;function validateUid(e){if("number"!==typeof e)throw TypeError($.UID)}function validateGid(e){if("number"!==typeof e)throw TypeError($.GID)}function flattenJSON(e){var t={};function flatten(e,r){for(var n in r){var o=r[n];var i=W(e,n);"string"===typeof o?t[i]=o:"object"===typeof o&&null!==o&&Object.keys(o).length>0?flatten(i,o):t[i]=null}}flatten("",e);return t}var Ne=function(){function Volume(r){void 0===r&&(r={});this.ino=0;this.inodes={};this.releasedInos=[];this.fds={};this.releasedFds=[];this.maxFiles=1e4;this.openFiles=0;this.promisesApi=(0,F.default)(this);this.statWatchers={};this.props=Object.assign({Node:a.Node,Link:a.Link,File:a.File},r);var n=this.createLink();n.setNode(this.createNode(true));var o=this;this.StatWatcher=function(t){e(StatWatcher,t);function StatWatcher(){return t.call(this,o)||this}return StatWatcher}(Oe);var i=FsReadStream;this.ReadStream=function(r){e(class_1,r);function class_1(){var e=[];for(var n=0;n<arguments.length;n++)e[n]=arguments[n];return r.apply(this,t([o],e,false))||this}return class_1}(i);var s=FsWriteStream;this.WriteStream=function(r){e(class_2,r);function class_2(){var e=[];for(var n=0;n<arguments.length;n++)e[n]=arguments[n];return r.apply(this,t([o],e,false))||this}return class_2}(s);this.FSWatcher=function(t){e(FSWatcher,t);function FSWatcher(){return t.call(this,o)||this}return FSWatcher}(Ie);this.root=n}Volume.fromJSON=function(e,t){var r=new Volume;r.fromJSON(e,t);return r};Volume.fromNestedJSON=function(e,t){var r=new Volume;r.fromNestedJSON(e,t);return r};Object.defineProperty(Volume.prototype,"promises",{get:function(){if(null===this.promisesApi)throw new Error("Promise is not supported in this environment.");return this.promisesApi},enumerable:false,configurable:true});Volume.prototype.createLink=function(e,t,r,n){void 0===r&&(r=false);if(!e)return new this.props.Link(this,null,"");if(!t)throw new Error("createLink: name cannot be empty");return e.createChild(t,this.createNode(r,n))};Volume.prototype.deleteLink=function(e){var t=e.parent;if(t){t.deleteChild(e);return true}return false};Volume.prototype.newInoNumber=function(){var e=this.releasedInos.pop();if(e)return e;this.ino=(this.ino+1)%4294967295;return this.ino};Volume.prototype.newFdNumber=function(){var e=this.releasedFds.pop();return"number"===typeof e?e:Volume.fd--};Volume.prototype.createNode=function(e,t){void 0===e&&(e=false);var r=new this.props.Node(this.newInoNumber(),t);e&&r.setIsDirectory();this.inodes[r.ino]=r;return r};Volume.prototype.getNode=function(e){return this.inodes[e]};Volume.prototype.deleteNode=function(e){e.del();delete this.inodes[e.ino];this.releasedInos.push(e.ino)};Volume.prototype.genRndStr=function(){var e=(Math.random()+1).toString(36).substr(2,6);return 6===e.length?e:this.genRndStr()};Volume.prototype.getLink=function(e){return this.root.walk(e)};Volume.prototype.getLinkOrThrow=function(e,t){var r=filenameToSteps(e);var n=this.getLink(r);if(!n)throw createError(Y,t,e);return n};Volume.prototype.getResolvedLink=function(e){var t="string"===typeof e?filenameToSteps(e):e;var r=this.root;var n=0;while(n<t.length){var o=t[n];r=r.getChild(o);if(!r)return null;var i=r.getNode();if(i.isSymlink()){t=i.symlink.concat(t.slice(n+1));r=this.root;n=0}else n++}return r};Volume.prototype.getResolvedLinkOrThrow=function(e,t){var r=this.getResolvedLink(e);if(!r)throw createError(Y,t,e);return r};Volume.prototype.resolveSymlinks=function(e){return this.getResolvedLink(e.steps.slice(1))};Volume.prototype.getLinkAsDirOrThrow=function(e,t){var r=this.getLinkOrThrow(e,t);if(!r.getNode().isDirectory())throw createError(Q,t,e);return r};Volume.prototype.getLinkParent=function(e){return this.root.walk(e,e.length-1)};Volume.prototype.getLinkParentAsDirOrThrow=function(e,t){var r=e instanceof Array?e:filenameToSteps(e);var n=this.getLinkParent(r);if(!n)throw createError(Y,t,D+r.join(D));if(!n.getNode().isDirectory())throw createError(Q,t,D+r.join(D));return n};Volume.prototype.getFileByFd=function(e){return this.fds[String(e)]};Volume.prototype.getFileByFdOrThrow=function(e,t){if(!isFd(e))throw TypeError($.FD);var r=this.getFileByFd(e);if(!r)throw createError(J,t);return r};Volume.prototype.getNodeByIdOrCreate=function(e,t,r){if("number"===typeof e){var n=this.getFileByFd(e);if(!n)throw Error("File nto found");return n.node}var o=pathToSteps(e);var i=this.getLink(o);if(i)return i.getNode();if(t&N){var a=this.getLinkParent(o);if(a){var s=o[o.length-1];i=this.createLink(a,s,false,r);return i.getNode()}}throw createError(Y,"getNodeByIdOrCreate",pathToFilename(e))};Volume.prototype.wrapAsync=function(e,t,r){var n=this;validateCallback(r);(0,p.default)((function(){var o;try{o=e.apply(n,t)}catch(e){r(e);return}r(null,o)}))};Volume.prototype._toJSON=function(e,t,r){var n;void 0===e&&(e=this.root);void 0===t&&(t={});var o=true;var i=e.children;if(e.getNode().isFile()){i=(n={},n[e.getName()]=e.parent.getChild(e.getName()),n);e=e.parent}for(var a in i){o=false;var s=e.getChild(a);if(!s)throw new Error("_toJSON: unexpected undefined");var u=s.getNode();if(u.isFile()){var c=s.getPath();r&&(c=U(r,c));t[c]=u.getString()}else u.isDirectory()&&this._toJSON(s,t,r)}var f=e.getPath();r&&(f=U(r,f));f&&o&&(t[f]=null);return t};Volume.prototype.toJSON=function(e,t,r){void 0===t&&(t={});void 0===r&&(r=false);var n=[];if(e){e instanceof Array||(e=[e]);for(var o=0,i=e;o<i.length;o++){var a=i[o];var s=pathToFilename(a);var u=this.getResolvedLink(s);u&&n.push(u)}}else n.push(this.root);if(!n.length)return t;for(var c=0,f=n;c<f.length;c++){u=f[c];this._toJSON(u,t,r?u.getPath():"")}return t};Volume.prototype.fromJSON=function(e,t){void 0===t&&(t=d.default.cwd());for(var r in e){var n=e[r];r=resolve(r,t);if("string"===typeof n){var o=G(r);this.mkdirpBase(o,511);this.writeFileSync(r,n)}else this.mkdirpBase(r,511)}};Volume.prototype.fromNestedJSON=function(e,t){this.fromJSON(flattenJSON(e),t)};Volume.prototype.reset=function(){this.ino=0;this.inodes={};this.releasedInos=[];this.fds={};this.releasedFds=[];this.openFiles=0;this.root=this.createLink();this.root.setNode(this.createNode(true))};Volume.prototype.mountSync=function(e,t){this.fromJSON(t,e)};Volume.prototype.openLink=function(e,t,r){void 0===r&&(r=true);if(this.openFiles>=this.maxFiles)throw createError(ee,"open",e.getPath());var n=e;r&&(n=this.resolveSymlinks(e));if(!n)throw createError(Y,"open",e.getPath());var o=n.getNode();if(o.isDirectory()){if((t&(T|R|b))!==T)throw createError(re,"open",e.getPath())}else if(t&A)throw createError(Q,"open",e.getPath());if(!(t&b)&&!o.canRead())throw createError(te,"open",e.getPath());var i=new this.props.File(e,o,t,this.newFdNumber());this.fds[i.fd]=i;this.openFiles++;t&k&&i.truncate();return i};Volume.prototype.openFile=function(e,t,r,n){void 0===n&&(n=true);var o=filenameToSteps(e);var i=n?this.getResolvedLink(o):this.getLink(o);if(!i&&t&N){var a=this.getResolvedLink(o.slice(0,o.length-1));if(!a)throw createError(Y,"open",D+o.join(D));t&N&&"number"===typeof r&&(i=this.createLink(a,o[o.length-1],false,r))}if(i)return this.openLink(i,t,n);throw createError(Y,"open",e)};Volume.prototype.openBase=function(e,t,r,n){void 0===n&&(n=true);var o=this.openFile(e,t,r,n);if(!o)throw createError(Y,"open",e);return o.fd};Volume.prototype.openSync=function(e,t,r){void 0===r&&(r=438);var n=modeToNumber(r);var o=pathToFilename(e);var i=flagsToNumber(t);return this.openBase(o,i,n)};Volume.prototype.open=function(e,t,r,n){var o=r;var i=n;if("function"===typeof r){o=438;i=r}o=o||438;var a=modeToNumber(o);var s=pathToFilename(e);var u=flagsToNumber(t);this.wrapAsync(this.openBase,[s,u,a],i)};Volume.prototype.closeFile=function(e){if(this.fds[e.fd]){this.openFiles--;delete this.fds[e.fd];this.releasedFds.push(e.fd)}};Volume.prototype.closeSync=function(e){validateFd(e);var t=this.getFileByFdOrThrow(e,"close");this.closeFile(t)};Volume.prototype.close=function(e,t){validateFd(e);this.wrapAsync(this.closeSync,[e],t)};Volume.prototype.openFileOrGetById=function(e,t,r){if("number"===typeof e){var n=this.fds[e];if(!n)throw createError(Y);return n}return this.openFile(pathToFilename(e),t,r)};Volume.prototype.readBase=function(e,t,r,n,o){var i=this.getFileByFdOrThrow(e);return i.read(t,Number(r),Number(n),o)};Volume.prototype.readSync=function(e,t,r,n,o){validateFd(e);return this.readBase(e,t,r,n,o)};Volume.prototype.read=function(e,t,r,n,o,i){var a=this;validateCallback(i);if(0===n)return d.default.nextTick((function(){i&&i(null,0,t)}));(0,p.default)((function(){try{var s=a.readBase(e,t,r,n,o);i(null,s,t)}catch(e){i(e)}}))};Volume.prototype.readFileBase=function(e,t,r){var n;var o="number"===typeof e;var i=o&&isFd(e);var a;if(i)a=e;else{var s=pathToFilename(e);var u=filenameToSteps(s);var c=this.getResolvedLink(u);if(c){var f=c.getNode();if(f.isDirectory())throw createError(re,"open",c.getPath())}a=this.openSync(e,t)}try{n=bufferToEncoding(this.getFileByFdOrThrow(a).getBuffer(),r)}finally{i||this.closeSync(a)}return n};Volume.prototype.readFileSync=function(e,t){var r=fe(t);var n=flagsToNumber(r.flag);return this.readFileBase(e,n,r.encoding)};Volume.prototype.readFile=function(e,t,r){var n=optsAndCbGenerator(fe)(t,r),o=n[0],i=n[1];var a=flagsToNumber(o.flag);this.wrapAsync(this.readFileBase,[e,a,o.encoding],i)};Volume.prototype.writeBase=function(e,t,r,n,o){var i=this.getFileByFdOrThrow(e,"write");return i.write(t,r,n,o)};Volume.prototype.writeSync=function(e,t,r,n,o){validateFd(e);var i;var a;var s;var u;var c="string"!==typeof t;if(c){a=0|(r||0);s=n;u=o}else{u=r;i=n}var f=dataToBuffer(t,i);if(c)"undefined"===typeof s&&(s=f.length);else{a=0;s=f.length}return this.writeBase(e,f,a,s,u)};Volume.prototype.write=function(e,t,r,n,o,i){var a=this;validateFd(e);var s;var u;var c;var f;var l;var d=typeof t;var h=typeof r;var m=typeof n;var y=typeof o;if("string"!==d)if("function"===h)l=r;else if("function"===m){s=0|r;l=n}else if("function"===y){s=0|r;u=n;l=o}else{s=0|r;u=n;c=o;l=i}else if("function"===h)l=r;else if("function"===m){c=r;l=n}else if("function"===y){c=r;f=n;l=o}var v=dataToBuffer(t,f);if("string"!==d)"undefined"===typeof u&&(u=v.length);else{s=0;u=v.length}var S=validateCallback(l);(0,p.default)((function(){try{var r=a.writeBase(e,v,s,u,c);S(null,r,"string"!==d?v:t)}catch(e){S(e)}}))};Volume.prototype.writeFileBase=function(e,t,r,n){var o="number"===typeof e;var i;i=o?e:this.openBase(pathToFilename(e),r,n);var a=0;var s=t.length;var u=r&I?void 0:0;try{while(s>0){var c=this.writeSync(i,t,a,s,u);a+=c;s-=c;void 0!==u&&(u+=c)}}finally{o||this.closeSync(i)}};Volume.prototype.writeFileSync=function(e,t,r){var n=pe(r);var o=flagsToNumber(n.flag);var i=modeToNumber(n.mode);var a=dataToBuffer(t,n.encoding);this.writeFileBase(e,a,o,i)};Volume.prototype.writeFile=function(e,t,r,n){var o=r;var i=n;if("function"===typeof r){o=le;i=r}var a=validateCallback(i);var s=pe(o);var u=flagsToNumber(s.flag);var c=modeToNumber(s.mode);var f=dataToBuffer(t,s.encoding);this.wrapAsync(this.writeFileBase,[e,f,u,c],a)};Volume.prototype.linkBase=function(e,t){var r=filenameToSteps(e);var n=this.getLink(r);if(!n)throw createError(Y,"link",e,t);var o=filenameToSteps(t);var i=this.getLinkParent(o);if(!i)throw createError(Y,"link",e,t);var a=o[o.length-1];if(i.getChild(a))throw createError(Z,"link",e,t);var s=n.getNode();s.nlink++;i.createChild(a,s)};Volume.prototype.copyFileBase=function(e,t,r){var n=this.readFileSync(e);if(r&B&&this.existsSync(t))throw createError(Z,"copyFile",e,t);if(r&C)throw createError(oe,"copyFile",e,t);this.writeFileBase(t,n,ie.w,438)};Volume.prototype.copyFileSync=function(e,t,r){var n=pathToFilename(e);var o=pathToFilename(t);return this.copyFileBase(n,o,0|(r||0))};Volume.prototype.copyFile=function(e,t,r,n){var o=pathToFilename(e);var i=pathToFilename(t);var a;var s;if("function"===typeof r){a=0;s=r}else{a=r;s=n}validateCallback(s);this.wrapAsync(this.copyFileBase,[o,i,a],s)};Volume.prototype.linkSync=function(e,t){var r=pathToFilename(e);var n=pathToFilename(t);this.linkBase(r,n)};Volume.prototype.link=function(e,t,r){var n=pathToFilename(e);var o=pathToFilename(t);this.wrapAsync(this.linkBase,[n,o],r)};Volume.prototype.unlinkBase=function(e){var t=filenameToSteps(e);var r=this.getLink(t);if(!r)throw createError(Y,"unlink",e);if(r.length)throw Error("Dir not empty...");this.deleteLink(r);var n=r.getNode();n.nlink--;n.nlink<=0&&this.deleteNode(n)};Volume.prototype.unlinkSync=function(e){var t=pathToFilename(e);this.unlinkBase(t)};Volume.prototype.unlink=function(e,t){var r=pathToFilename(e);this.wrapAsync(this.unlinkBase,[r],t)};Volume.prototype.symlinkBase=function(e,t){var r=filenameToSteps(t);var n=this.getLinkParent(r);if(!n)throw createError(Y,"symlink",e,t);var o=r[r.length-1];if(n.getChild(o))throw createError(Z,"symlink",e,t);var i=n.createChild(o);i.getNode().makeSymlink(filenameToSteps(e));return i};Volume.prototype.symlinkSync=function(e,t,r){var n=pathToFilename(e);var o=pathToFilename(t);this.symlinkBase(n,o)};Volume.prototype.symlink=function(e,t,r,n){var o=validateCallback("function"===typeof r?r:n);var i=pathToFilename(e);var a=pathToFilename(t);this.wrapAsync(this.symlinkBase,[i,a],o)};Volume.prototype.realpathBase=function(e,t){var r=filenameToSteps(e);var n=this.getResolvedLink(r);if(!n)throw createError(Y,"realpath",e);return(0,S.strToEncoding)(n.getPath(),t)};Volume.prototype.realpathSync=function(e,t){return this.realpathBase(pathToFilename(e),ve(t).encoding)};Volume.prototype.realpath=function(e,t,r){var n=Se(t,r),o=n[0],i=n[1];var a=pathToFilename(e);this.wrapAsync(this.realpathBase,[a,o.encoding],i)};Volume.prototype.lstatBase=function(e,t){void 0===t&&(t=false);var r=this.getLink(filenameToSteps(e));if(!r)throw createError(Y,"lstat",e);return c.default.build(r.getNode(),t)};Volume.prototype.lstatSync=function(e,t){return this.lstatBase(pathToFilename(e),getStatOptions(t).bigint)};Volume.prototype.lstat=function(e,t,r){var n=getStatOptsAndCb(t,r),o=n[0],i=n[1];this.wrapAsync(this.lstatBase,[pathToFilename(e),o.bigint],i)};Volume.prototype.statBase=function(e,t){void 0===t&&(t=false);var r=this.getResolvedLink(filenameToSteps(e));if(!r)throw createError(Y,"stat",e);return c.default.build(r.getNode(),t)};Volume.prototype.statSync=function(e,t){return this.statBase(pathToFilename(e),getStatOptions(t).bigint)};Volume.prototype.stat=function(e,t,r){var n=getStatOptsAndCb(t,r),o=n[0],i=n[1];this.wrapAsync(this.statBase,[pathToFilename(e),o.bigint],i)};Volume.prototype.fstatBase=function(e,t){void 0===t&&(t=false);var r=this.getFileByFd(e);if(!r)throw createError(J,"fstat");return c.default.build(r.node,t)};Volume.prototype.fstatSync=function(e,t){return this.fstatBase(e,getStatOptions(t).bigint)};Volume.prototype.fstat=function(e,t,r){var n=getStatOptsAndCb(t,r),o=n[0],i=n[1];this.wrapAsync(this.fstatBase,[e,o.bigint],i)};Volume.prototype.renameBase=function(e,r){var n=this.getLink(filenameToSteps(e));if(!n)throw createError(Y,"rename",e,r);var o=filenameToSteps(r);var i=this.getLinkParent(o);if(!i)throw createError(Y,"rename",e,r);var a=n.parent;a&&a.deleteChild(n);var s=o[o.length-1];n.steps=t(t([],i.steps,true),[s],false);i.setChild(n.getName(),n)};Volume.prototype.renameSync=function(e,t){var r=pathToFilename(e);var n=pathToFilename(t);this.renameBase(r,n)};Volume.prototype.rename=function(e,t,r){var n=pathToFilename(e);var o=pathToFilename(t);this.wrapAsync(this.renameBase,[n,o],r)};Volume.prototype.existsBase=function(e){return!!this.statBase(e)};Volume.prototype.existsSync=function(e){try{return this.existsBase(pathToFilename(e))}catch(e){return false}};Volume.prototype.exists=function(e,t){var r=this;var n=pathToFilename(e);if("function"!==typeof t)throw Error($.CB);(0,p.default)((function(){try{t(r.existsBase(n))}catch(e){t(false)}}))};Volume.prototype.accessBase=function(e,t){this.getLinkOrThrow(e,"access")};Volume.prototype.accessSync=function(e,t){void 0===t&&(t=V);var r=pathToFilename(e);t|=0;this.accessBase(r,t)};Volume.prototype.access=function(e,t,r){var n=V;var o;if("function"!==typeof t){n=0|t;o=validateCallback(r)}else o=t;var i=pathToFilename(e);this.wrapAsync(this.accessBase,[i,n],o)};Volume.prototype.appendFileSync=function(e,t,r){void 0===r&&(r=de);var n=he(r);n.flag&&!isFd(e)||(n.flag="a");this.writeFileSync(e,t,n)};Volume.prototype.appendFile=function(e,t,r,n){var o=me(r,n),i=o[0],a=o[1];i.flag&&!isFd(e)||(i.flag="a");this.writeFile(e,t,i,a)};Volume.prototype.readdirBase=function(e,t){var r=filenameToSteps(e);var n=this.getResolvedLink(r);if(!n)throw createError(Y,"readdir",e);var o=n.getNode();if(!o.isDirectory())throw createError(Q,"scandir",e);if(t.withFileTypes){var i=[];for(var a in n.children){var s=n.getChild(a);s&&i.push(f.default.build(s,t.encoding))}H||"buffer"===t.encoding||i.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));return i}var u=[];for(var c in n.children)u.push((0,S.strToEncoding)(c,t.encoding));H||"buffer"===t.encoding||u.sort();return u};Volume.prototype.readdirSync=function(e,t){var r=Fe(t);var n=pathToFilename(e);return this.readdirBase(n,r)};Volume.prototype.readdir=function(e,t,r){var n=we(t,r),o=n[0],i=n[1];var a=pathToFilename(e);this.wrapAsync(this.readdirBase,[a,o],i)};Volume.prototype.readlinkBase=function(e,t){var r=this.getLinkOrThrow(e,"readlink");var n=r.getNode();if(!n.isSymlink())throw createError(X,"readlink",e);var o=D+n.symlink.join(D);return(0,S.strToEncoding)(o,t)};Volume.prototype.readlinkSync=function(e,t){var r=se(t);var n=pathToFilename(e);return this.readlinkBase(n,r.encoding)};Volume.prototype.readlink=function(e,t,r){var n=ue(t,r),o=n[0],i=n[1];var a=pathToFilename(e);this.wrapAsync(this.readlinkBase,[a,o.encoding],i)};Volume.prototype.fsyncBase=function(e){this.getFileByFdOrThrow(e,"fsync")};Volume.prototype.fsyncSync=function(e){this.fsyncBase(e)};Volume.prototype.fsync=function(e,t){this.wrapAsync(this.fsyncBase,[e],t)};Volume.prototype.fdatasyncBase=function(e){this.getFileByFdOrThrow(e,"fdatasync")};Volume.prototype.fdatasyncSync=function(e){this.fdatasyncBase(e)};Volume.prototype.fdatasync=function(e,t){this.wrapAsync(this.fdatasyncBase,[e],t)};Volume.prototype.ftruncateBase=function(e,t){var r=this.getFileByFdOrThrow(e,"ftruncate");r.truncate(t)};Volume.prototype.ftruncateSync=function(e,t){this.ftruncateBase(e,t)};Volume.prototype.ftruncate=function(e,t,r){var n="number"===typeof t?t:0;var o=validateCallback("number"===typeof t?r:t);this.wrapAsync(this.ftruncateBase,[e,n],o)};Volume.prototype.truncateBase=function(e,t){var r=this.openSync(e,"r+");try{this.ftruncateSync(r,t)}finally{this.closeSync(r)}};Volume.prototype.truncateSync=function(e,t){if(isFd(e))return this.ftruncateSync(e,t);this.truncateBase(e,t)};Volume.prototype.truncate=function(e,t,r){var n="number"===typeof t?t:0;var o=validateCallback("number"===typeof t?r:t);if(isFd(e))return this.ftruncate(e,n,o);this.wrapAsync(this.truncateBase,[e,n],o)};Volume.prototype.futimesBase=function(e,t,r){var n=this.getFileByFdOrThrow(e,"futimes");var o=n.node;o.atime=new Date(1e3*t);o.mtime=new Date(1e3*r)};Volume.prototype.futimesSync=function(e,t,r){this.futimesBase(e,toUnixTimestamp(t),toUnixTimestamp(r))};Volume.prototype.futimes=function(e,t,r,n){this.wrapAsync(this.futimesBase,[e,toUnixTimestamp(t),toUnixTimestamp(r)],n)};Volume.prototype.utimesBase=function(e,t,r){var n=this.openSync(e,"r+");try{this.futimesBase(n,t,r)}finally{this.closeSync(n)}};Volume.prototype.utimesSync=function(e,t,r){this.utimesBase(pathToFilename(e),toUnixTimestamp(t),toUnixTimestamp(r))};Volume.prototype.utimes=function(e,t,r,n){this.wrapAsync(this.utimesBase,[pathToFilename(e),toUnixTimestamp(t),toUnixTimestamp(r)],n)};Volume.prototype.mkdirBase=function(e,t){var r=filenameToSteps(e);if(!r.length)throw createError(Z,"mkdir",e);var n=this.getLinkParentAsDirOrThrow(e,"mkdir");var o=r[r.length-1];if(n.getChild(o))throw createError(Z,"mkdir",e);n.createChild(o,this.createNode(true,t))};
/**
     * Creates directory tree recursively.
     * @param filename
     * @param modeNum
     */Volume.prototype.mkdirpBase=function(e,t){var r=filenameToSteps(e);var n=this.root;for(var o=0;o<r.length;o++){var i=r[o];if(!n.getNode().isDirectory())throw createError(Q,"mkdir",n.getPath());var a=n.getChild(i);if(a){if(!a.getNode().isDirectory())throw createError(Q,"mkdir",a.getPath());n=a}else n=n.createChild(i,this.createNode(true,t))}};Volume.prototype.mkdirSync=function(e,t){var r=getMkdirOptions(t);var n=modeToNumber(r.mode,511);var o=pathToFilename(e);r.recursive?this.mkdirpBase(o,n):this.mkdirBase(o,n)};Volume.prototype.mkdir=function(e,t,r){var n=getMkdirOptions(t);var o=validateCallback("function"===typeof t?t:r);var i=modeToNumber(n.mode,511);var a=pathToFilename(e);n.recursive?this.wrapAsync(this.mkdirpBase,[a,i],o):this.wrapAsync(this.mkdirBase,[a,i],o)};Volume.prototype.mkdirpSync=function(e,t){this.mkdirSync(e,{mode:t,recursive:true})};Volume.prototype.mkdirp=function(e,t,r){var n="function"===typeof t?void 0:t;var o=validateCallback("function"===typeof t?t:r);this.mkdir(e,{mode:n,recursive:true},o)};Volume.prototype.mkdtempBase=function(e,t,r){void 0===r&&(r=5);var n=e+this.genRndStr();try{this.mkdirBase(n,511);return(0,S.strToEncoding)(n,t)}catch(n){if(n.code===Z){if(r>1)return this.mkdtempBase(e,t,r-1);throw Error("Could not create temp dir.")}throw n}};Volume.prototype.mkdtempSync=function(e,t){var r=se(t).encoding;if(!e||"string"!==typeof e)throw new TypeError("filename prefix is required");nullCheck(e);return this.mkdtempBase(e,r)};Volume.prototype.mkdtemp=function(e,t,r){var n=ue(t,r),o=n[0].encoding,i=n[1];if(!e||"string"!==typeof e)throw new TypeError("filename prefix is required");nullCheck(e)&&this.wrapAsync(this.mkdtempBase,[e,o],i)};Volume.prototype.rmdirBase=function(e,t){var r=getRmdirOptions(t);var n=this.getLinkAsDirOrThrow(e,"rmdir");if(n.length&&!r.recursive)throw createError(ne,"rmdir",e);this.deleteLink(n)};Volume.prototype.rmdirSync=function(e,t){this.rmdirBase(pathToFilename(e),t)};Volume.prototype.rmdir=function(e,t,r){var n=getRmdirOptions(t);var o=validateCallback("function"===typeof t?t:r);this.wrapAsync(this.rmdirBase,[pathToFilename(e),n],o)};Volume.prototype.fchmodBase=function(e,t){var r=this.getFileByFdOrThrow(e,"fchmod");r.chmod(t)};Volume.prototype.fchmodSync=function(e,t){this.fchmodBase(e,modeToNumber(t))};Volume.prototype.fchmod=function(e,t,r){this.wrapAsync(this.fchmodBase,[e,modeToNumber(t)],r)};Volume.prototype.chmodBase=function(e,t){var r=this.openSync(e,"r+");try{this.fchmodBase(r,t)}finally{this.closeSync(r)}};Volume.prototype.chmodSync=function(e,t){var r=modeToNumber(t);var n=pathToFilename(e);this.chmodBase(n,r)};Volume.prototype.chmod=function(e,t,r){var n=modeToNumber(t);var o=pathToFilename(e);this.wrapAsync(this.chmodBase,[o,n],r)};Volume.prototype.lchmodBase=function(e,t){var r=this.openBase(e,R,0,false);try{this.fchmodBase(r,t)}finally{this.closeSync(r)}};Volume.prototype.lchmodSync=function(e,t){var r=modeToNumber(t);var n=pathToFilename(e);this.lchmodBase(n,r)};Volume.prototype.lchmod=function(e,t,r){var n=modeToNumber(t);var o=pathToFilename(e);this.wrapAsync(this.lchmodBase,[o,n],r)};Volume.prototype.fchownBase=function(e,t,r){this.getFileByFdOrThrow(e,"fchown").chown(t,r)};Volume.prototype.fchownSync=function(e,t,r){validateUid(t);validateGid(r);this.fchownBase(e,t,r)};Volume.prototype.fchown=function(e,t,r,n){validateUid(t);validateGid(r);this.wrapAsync(this.fchownBase,[e,t,r],n)};Volume.prototype.chownBase=function(e,t,r){var n=this.getResolvedLinkOrThrow(e,"chown");var o=n.getNode();o.chown(t,r)};Volume.prototype.chownSync=function(e,t,r){validateUid(t);validateGid(r);this.chownBase(pathToFilename(e),t,r)};Volume.prototype.chown=function(e,t,r,n){validateUid(t);validateGid(r);this.wrapAsync(this.chownBase,[pathToFilename(e),t,r],n)};Volume.prototype.lchownBase=function(e,t,r){this.getLinkOrThrow(e,"lchown").getNode().chown(t,r)};Volume.prototype.lchownSync=function(e,t,r){validateUid(t);validateGid(r);this.lchownBase(pathToFilename(e),t,r)};Volume.prototype.lchown=function(e,t,r,n){validateUid(t);validateGid(r);this.wrapAsync(this.lchownBase,[pathToFilename(e),t,r],n)};Volume.prototype.watchFile=function(e,t,r){var n=pathToFilename(e);var o=t;var i=r;if("function"===typeof o){i=t;o=null}if("function"!==typeof i)throw Error('"watchFile()" requires a listener function');var a=5007;var s=true;if(o&&"object"===typeof o){"number"===typeof o.interval&&(a=o.interval);"boolean"===typeof o.persistent&&(s=o.persistent)}var u=this.statWatchers[n];if(!u){u=new this.StatWatcher;u.start(n,s,a);this.statWatchers[n]=u}u.addListener("change",i);return u};Volume.prototype.unwatchFile=function(e,t){var r=pathToFilename(e);var n=this.statWatchers[r];if(n){"function"===typeof t?n.removeListener("change",t):n.removeAllListeners("change");if(0===n.listenerCount("change")){n.stop();delete this.statWatchers[r]}}};Volume.prototype.createReadStream=function(e,t){return new this.ReadStream(e,t)};Volume.prototype.createWriteStream=function(e,t){return new this.WriteStream(e,t)};Volume.prototype.watch=function(e,t,r){var n=pathToFilename(e);var o=t;if("function"===typeof t){r=t;o=null}var i=se(o),a=i.persistent,s=i.recursive,u=i.encoding;void 0===a&&(a=true);void 0===s&&(s=false);var c=new this.FSWatcher;c.start(n,a,s,u);r&&c.addListener("change",r);return c};
/**
     * Global file descriptor counter. UNIX file descriptors start from 0 and go sequentially
     * up, so here, in order not to conflict with them, we choose some big number and descrease
     * the file descriptor of every new opened file.
     * @type {number}
     * @todo This should not be static, right?
     */Volume.fd=2147483647;return Volume}();M.Volume=Ne;function emitStop(e){e.emit("stop")}var Oe=function(t){e(StatWatcher,t);function StatWatcher(e){var r=t.call(this)||this;r.onInterval=function(){try{var e=r.vol.statSync(r.filename);if(r.hasChanged(e)){r.emit("change",e,r.prev);r.prev=e}}finally{r.loop()}};r.vol=e;return r}StatWatcher.prototype.loop=function(){this.timeoutRef=this.setTimeout(this.onInterval,this.interval)};StatWatcher.prototype.hasChanged=function(e){return e.mtimeMs>this.prev.mtimeMs||e.nlink!==this.prev.nlink};StatWatcher.prototype.start=function(e,t,r){void 0===t&&(t=true);void 0===r&&(r=5007);this.filename=pathToFilename(e);this.setTimeout=t?setTimeout.bind("undefined"!==typeof globalThis?globalThis:j):h.default;this.interval=r;this.prev=this.vol.statSync(this.filename);this.loop()};StatWatcher.prototype.stop=function(){clearTimeout(this.timeoutRef);d.default.nextTick(emitStop,this)};return StatWatcher}(v.EventEmitter);M.StatWatcher=Oe;var ke;function allocNewPool(e){ke=(0,l.bufferAllocUnsafe)(e);ke.used=0}g.inherits(FsReadStream,m.Readable);M.ReadStream=FsReadStream;function FsReadStream(e,t,r){if(!(this instanceof FsReadStream))return new FsReadStream(e,t,r);this._vol=e;r=Object.assign({},getOptions(r,{}));void 0===r.highWaterMark&&(r.highWaterMark=65536);m.Readable.call(this,r);this.path=pathToFilename(t);this.fd=void 0===r.fd?null:r.fd;this.flags=void 0===r.flags?"r":r.flags;this.mode=void 0===r.mode?438:r.mode;this.start=r.start;this.end=r.end;this.autoClose=void 0===r.autoClose||r.autoClose;this.pos=void 0;this.bytesRead=0;if(void 0!==this.start){if("number"!==typeof this.start)throw new TypeError('"start" option must be a Number');if(void 0===this.end)this.end=Infinity;else if("number"!==typeof this.end)throw new TypeError('"end" option must be a Number');if(this.start>this.end)throw new Error('"start" option must be <= "end" option');this.pos=this.start}"number"!==typeof this.fd&&this.open();this.on("end",(function(){this.autoClose&&this.destroy&&this.destroy()}))}FsReadStream.prototype.open=function(){var e=this;this._vol.open(this.path,this.flags,this.mode,(function(t,r){if(t){e.autoClose&&e.destroy&&e.destroy();e.emit("error",t)}else{e.fd=r;e.emit("open",r);e.read()}}))};FsReadStream.prototype._read=function(e){if("number"!==typeof this.fd)return this.once("open",(function(){this._read(e)}));if(!this.destroyed){(!ke||ke.length-ke.used<K)&&allocNewPool(this._readableState.highWaterMark);var t=ke;var r=Math.min(ke.length-ke.used,e);var n=ke.used;void 0!==this.pos&&(r=Math.min(this.end-this.pos+1,r));if(r<=0)return this.push(null);var o=this;this._vol.read(this.fd,ke,ke.used,r,this.pos,onread);void 0!==this.pos&&(this.pos+=r);ke.used+=r}function onread(e,r){if(e){o.autoClose&&o.destroy&&o.destroy();o.emit("error",e)}else{var i=null;if(r>0){o.bytesRead+=r;i=t.slice(n,n+r)}o.push(i)}}};FsReadStream.prototype._destroy=function(e,t){this.close((function(r){t(e||r)}))};FsReadStream.prototype.close=function(e){var t=this;e&&this.once("close",e);if(this.closed||"number"!==typeof this.fd){if("number"!==typeof this.fd){this.once("open",closeOnOpen);return}return d.default.nextTick((function(){return t.emit("close")}))}this.closed=true;this._vol.close(this.fd,(function(e){e?t.emit("error",e):t.emit("close")}));this.fd=null};function closeOnOpen(e){this.close()}g.inherits(FsWriteStream,m.Writable);M.WriteStream=FsWriteStream;function FsWriteStream(e,t,r){if(!(this instanceof FsWriteStream))return new FsWriteStream(e,t,r);this._vol=e;r=Object.assign({},getOptions(r,{}));m.Writable.call(this,r);this.path=pathToFilename(t);this.fd=void 0===r.fd?null:r.fd;this.flags=void 0===r.flags?"w":r.flags;this.mode=void 0===r.mode?438:r.mode;this.start=r.start;this.autoClose=void 0===r.autoClose||!!r.autoClose;this.pos=void 0;this.bytesWritten=0;if(void 0!==this.start){if("number"!==typeof this.start)throw new TypeError('"start" option must be a Number');if(this.start<0)throw new Error('"start" must be >= zero');this.pos=this.start}r.encoding&&this.setDefaultEncoding(r.encoding);"number"!==typeof this.fd&&this.open();this.once("finish",(function(){this.autoClose&&this.close()}))}FsWriteStream.prototype.open=function(){this._vol.open(this.path,this.flags,this.mode,function(e,t){if(e){this.autoClose&&this.destroy&&this.destroy();this.emit("error",e)}else{this.fd=t;this.emit("open",t)}}.bind(this))};FsWriteStream.prototype._write=function(e,t,r){if(!(e instanceof l.Buffer))return this.emit("error",new Error("Invalid data"));if("number"!==typeof this.fd)return this.once("open",(function(){this._write(e,t,r)}));var n=this;this._vol.write(this.fd,e,0,e.length,this.pos,(function(e,t){if(e){n.autoClose&&n.destroy&&n.destroy();return r(e)}n.bytesWritten+=t;r()}));void 0!==this.pos&&(this.pos+=e.length)};FsWriteStream.prototype._writev=function(e,t){if("number"!==typeof this.fd)return this.once("open",(function(){this._writev(e,t)}));var r=this;var n=e.length;var o=new Array(n);var i=0;for(var a=0;a<n;a++){var s=e[a].chunk;o[a]=s;i+=s.length}var u=l.Buffer.concat(o);this._vol.write(this.fd,u,0,u.length,this.pos,(function(e,n){if(e){r.destroy&&r.destroy();return t(e)}r.bytesWritten+=n;t()}));void 0!==this.pos&&(this.pos+=i)};FsWriteStream.prototype._destroy=FsReadStream.prototype._destroy;FsWriteStream.prototype.close=FsReadStream.prototype.close;FsWriteStream.prototype.destroySoon=FsWriteStream.prototype.end;var Ie=function(t){e(FSWatcher,t);function FSWatcher(e){var r=t.call(this)||this;r._filename="";r._filenameEncoded="";r._recursive=false;r._encoding=S.ENCODING_UTF8;r._onNodeChange=function(){r._emit("change")};r._onParentChild=function(e){e.getName()===r._getName()&&r._emit("rename")};r._emit=function(e){r.emit("change",e,r._filenameEncoded)};r._persist=function(){r._timer=setTimeout(r._persist,1e6)};r._vol=e;return r}FSWatcher.prototype._getName=function(){return this._steps[this._steps.length-1]};FSWatcher.prototype.start=function(e,t,r,n){void 0===t&&(t=true);void 0===r&&(r=false);void 0===n&&(n=S.ENCODING_UTF8);this._filename=pathToFilename(e);this._steps=filenameToSteps(this._filename);this._filenameEncoded=(0,S.strToEncoding)(this._filename);this._recursive=r;this._encoding=n;try{this._link=this._vol.getLinkOrThrow(this._filename,"FSWatcher")}catch(e){var o=new Error("watch "+this._filename+" "+e.code);o.code=e.code;o.errno=e.code;throw o}this._link.getNode().on("change",this._onNodeChange);this._link.on("child:add",this._onNodeChange);this._link.on("child:delete",this._onNodeChange);var i=this._link.parent;if(i){i.setMaxListeners(i.getMaxListeners()+1);i.on("child:delete",this._onParentChild)}t&&this._persist()};FSWatcher.prototype.close=function(){clearTimeout(this._timer);this._link.getNode().removeListener("change",this._onNodeChange);var e=this._link.parent;e&&e.removeListener("child:delete",this._onParentChild)};return FSWatcher}(v.EventEmitter);M.FSWatcher=Ie;return M}var G={},H=false;function dew$1(){if(H)return G;H=true;Object.defineProperty(G,"__esModule",{value:true});G.fsAsyncMethods=G.fsSyncMethods=G.fsProps=void 0;var e=["constants","F_OK","R_OK","W_OK","X_OK","Stats"];G.fsProps=e;var t=["renameSync","ftruncateSync","truncateSync","chownSync","fchownSync","lchownSync","chmodSync","fchmodSync","lchmodSync","statSync","lstatSync","fstatSync","linkSync","symlinkSync","readlinkSync","realpathSync","unlinkSync","rmdirSync","mkdirSync","mkdirpSync","readdirSync","closeSync","openSync","utimesSync","futimesSync","fsyncSync","writeSync","readSync","readFileSync","writeFileSync","appendFileSync","existsSync","accessSync","fdatasyncSync","mkdtempSync","copyFileSync","createReadStream","createWriteStream"];G.fsSyncMethods=t;var r=["rename","ftruncate","truncate","chown","fchown","lchown","chmod","fchmod","lchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","mkdirp","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","exists","access","fdatasync","mkdtemp","copyFile","watchFile","unwatchFile","watch"];G.fsAsyncMethods=r;return G}var K={},$=false;function dew(){if($)return K;$=true;var e=K&&K.__assign||function(){e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};return e.apply(this,arguments)};Object.defineProperty(K,"__esModule",{value:true});K.fs=K.createFsFromVolume=K.vol=K.Volume=void 0;var t=dew$d();var r=dew$9();var n=dew$2();var o=dew$1(),i=o.fsSyncMethods,a=o.fsAsyncMethods;var s=dew$f();var u=s.constants.F_OK,c=s.constants.R_OK,f=s.constants.W_OK,l=s.constants.X_OK;K.Volume=n.Volume;K.vol=new n.Volume;function createFsFromVolume(e){var o={F_OK:u,R_OK:c,W_OK:f,X_OK:l,constants:s.constants,Stats:t.default,Dirent:r.default};for(var p=0,d=i;p<d.length;p++){var h=d[p];"function"===typeof e[h]&&(o[h]=e[h].bind(e))}for(var m=0,y=a;m<y.length;m++){h=y[m];"function"===typeof e[h]&&(o[h]=e[h].bind(e))}o.StatWatcher=e.StatWatcher;o.FSWatcher=e.FSWatcher;o.WriteStream=e.WriteStream;o.ReadStream=e.ReadStream;o.promises=e.promises;o._toUnixTimestamp=n.toUnixTimestamp;return o}K.createFsFromVolume=createFsFromVolume;K.fs=createFsFromVolume(K.vol);K=e(e({},K),K.fs);K.semantic=true;return K}const Y=dew();Y.__esModule;Y.fs;Y.createFsFromVolume;Y.vol;Y.Volume;Y.semantic;const J=dew$2();J.__esModule;J.FSWatcher;J.StatWatcher;J.Volume;J.toUnixTimestamp;J.bufferToEncoding;J.dataToBuffer;J.dataToStr;J.pathToSteps;J.filenameToSteps;J.pathToFilename;J.flagsToNumber;J.FLAGS;J.ReadStream;J.WriteStream;const{vol:X,createFsFromVolume:q}=Y;function unimplemented(e){throw new Error(`Node.js fs ${e} is not supported by JSPM core in the browser`)}X.fromNestedJSON({"/dev":{stdin:"",stdout:"",stderr:""},"/usr/bin":{},"/home":{},"/tmp":{}});X.releasedFds=[2,1,0];X.openSync("/dev/stdin","w");X.openSync("/dev/stdout","r");X.openSync("/dev/stderr","r");watchStdo("/dev/stdout",1,console.log);watchStdo("/dev/stderr",2,console.error);function watchStdo(e,t,r){let n=0;const o=new TextDecoder;X.watch(e,"utf8",(()=>{const{size:e}=X.fstatSync(t);const i=c.alloc(e-n);X.readSync(t,i,0,i.length,n);n=e;r(o.decode(i,{stream:true}))}))}const z=q(X);z.opendir=()=>unimplemented("opendir");z.opendirSync=()=>unimplemented("opendirSync");z.promises.opendir=()=>unimplemented("promises.opendir");z.cp=()=>unimplemented("cp");z.cpSync=()=>unimplemented("cpSync");z.promises.cp=()=>unimplemented("promises.cp");z.readv=()=>unimplemented("readv");z.readvSync=()=>unimplemented("readvSync");z.rm=()=>unimplemented("rm");z.rmSync=()=>unimplemented("rmSync");z.promises.rm=()=>unimplemented("promises.rm");z.Dir=()=>unimplemented("Dir");z.promises.watch=()=>unimplemented("promises.watch");z.FileReadStream=z.ReadStream;z.FileWriteStream=z.WriteStream;function handleFsUrl(e,t){if("file:"===e.protocol)return a(e);if("https:"===e.protocol||"http:"===e.protocol){const r="\\\\url\\"+e.href.replaceAll(/\//g,"\\\\");if(me(r))return r;if(t)throw new Error(`Cannot sync request URL ${e} via FS. JSPM FS support for network URLs requires using async FS methods or priming the MemFS cache first with an async request before a sync request.`);return(async()=>{const t=await fetch(e);if(!t.ok)throw new Error(`Unable to fetch ${e.href}, ${t.status}`);const n=await t.arrayBuffer();Tt(r,c.from(n));return r})()}throw new Error("URL "+e+" not supported in JSPM FS implementation.")}function wrapFsSync(e){return function(t,...r){return t instanceof URL?e(handleFsUrl(t,true),...r):e(t,...r)}}function wrapFsPromise(e){return async function(t,...r){return t instanceof URL?e(await handleFsUrl(t),...r):e(t,...r)}}function wrapFsCallback(e){return function(t,...r){const n=r[r.length-1];t instanceof URL&&"function"===typeof n?handleFsUrl(t).then((t=>{e(t,...r)}),n):e(t,...r)}}z.promises.readFile=wrapFsPromise(z.promises.readFile);z.readFile=wrapFsCallback(z.readFile);z.readFileSync=wrapFsSync(z.readFileSync);const{appendFile:Z,appendFileSync:Q,access:ee,accessSync:te,chown:re,chownSync:ne,chmod:oe,chmodSync:ie,close:ae,closeSync:se,copyFile:ue,copyFileSync:ce,cp:fe,cpSync:le,createReadStream:pe,createWriteStream:de,exists:he,existsSync:me,fchown:ye,fchownSync:ve,fchmod:Se,fchmodSync:_e,fdatasync:ge,fdatasyncSync:Ee,fstat:Fe,fstatSync:we,fsync:Te,fsyncSync:be,ftruncate:Re,ftruncateSync:Ne,futimes:Oe,futimesSync:ke,lchown:Ie,lchownSync:Le,lchmod:Ae,lchmodSync:Ve,link:Be,linkSync:Ce,lstat:Pe,lstatSync:De,mkdir:Ue,mkdirSync:We,mkdtemp:Me,mkdtempSync:xe,open:je,openSync:Ge,opendir:He,opendirSync:Ke,readdir:$e,readdirSync:Ye,read:Je,readSync:Xe,readv:qe,readvSync:ze,readFile:Ze,readFileSync:Qe,readlink:et,readlinkSync:tt,realpath:rt,realpathSync:nt,rename:ot,renameSync:it,rm:at,rmSync:st,rmdir:ut,rmdirSync:ct,stat:ft,statSync:lt,symlink:pt,symlinkSync:dt,truncate:ht,truncateSync:mt,unwatchFile:yt,unlink:vt,unlinkSync:St,utimes:_t,utimesSync:gt,watch:Et,watchFile:Ft,writeFile:wt,writeFileSync:Tt,write:bt,writeSync:Rt,writev:Nt,writevSync:Ot,Dir:kt,Dirent:It,Stats:Lt,ReadStream:At,WriteStream:Vt,FileReadStream:Bt,FileWriteStream:Ct,_toUnixTimestamp:Pt,constants:{F_OK:Dt,R_OK:Ut,W_OK:Wt,X_OK:Mt},constants:xt,promises:jt}=z;export{kt as Dir,It as Dirent,Dt as F_OK,Bt as FileReadStream,Ct as FileWriteStream,Ut as R_OK,At as ReadStream,Lt as Stats,Wt as W_OK,Vt as WriteStream,Mt as X_OK,Pt as _toUnixTimestamp,ee as access,te as accessSync,Z as appendFile,Q as appendFileSync,oe as chmod,ie as chmodSync,re as chown,ne as chownSync,ae as close,se as closeSync,xt as constants,ue as copyFile,ce as copyFileSync,fe as cp,le as cpSync,pe as createReadStream,de as createWriteStream,z as default,he as exists,me as existsSync,Se as fchmod,_e as fchmodSync,ye as fchown,ve as fchownSync,ge as fdatasync,Ee as fdatasyncSync,Fe as fstat,we as fstatSync,Te as fsync,be as fsyncSync,Re as ftruncate,Ne as ftruncateSync,Oe as futimes,ke as futimesSync,Ae as lchmod,Ve as lchmodSync,Ie as lchown,Le as lchownSync,Be as link,Ce as linkSync,Pe as lstat,De as lstatSync,Ue as mkdir,We as mkdirSync,Me as mkdtemp,xe as mkdtempSync,je as open,Ge as openSync,He as opendir,Ke as opendirSync,jt as promises,Je as read,Ze as readFile,Qe as readFileSync,Xe as readSync,$e as readdir,Ye as readdirSync,et as readlink,tt as readlinkSync,qe as readv,ze as readvSync,rt as realpath,nt as realpathSync,ot as rename,it as renameSync,at as rm,st as rmSync,ut as rmdir,ct as rmdirSync,ft as stat,lt as statSync,pt as symlink,dt as symlinkSync,ht as truncate,mt as truncateSync,vt as unlink,St as unlinkSync,yt as unwatchFile,_t as utimes,gt as utimesSync,Et as watch,Ft as watchFile,bt as write,wt as writeFile,Tt as writeFileSync,Rt as writeSync,Nt as writev,Ot as writevSync};

