import*as e from"fs";import*as t from"constants";import n from"process";import*as r from"stream";import*as o from"util";import*as i from"assert";var a="default"in t?t.default:t;var c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var u={};var f=n;var l=a;var s=f.cwd;var d=null;var p=f.env.GRACEFUL_FS_PLATFORM||f.platform;f.cwd=function(){d||(d=s.call(f));return d};try{f.cwd()}catch(e){}if("function"===typeof f.chdir){var h=f.chdir;f.chdir=function(e){d=null;h.call(f,e)};Object.setPrototypeOf&&Object.setPrototypeOf(f.chdir,h)}u=patch$1;function patch$1(e){l.hasOwnProperty("O_SYMLINK")&&f.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&patchLchmod(e);e.lutimes||patchLutimes(e);e.chown=chownFix(e.chown);e.fchown=chownFix(e.fchown);e.lchown=chownFix(e.lchown);e.chmod=chmodFix(e.chmod);e.fchmod=chmodFix(e.fchmod);e.lchmod=chmodFix(e.lchmod);e.chownSync=chownFixSync(e.chownSync);e.fchownSync=chownFixSync(e.fchownSync);e.lchownSync=chownFixSync(e.lchownSync);e.chmodSync=chmodFixSync(e.chmodSync);e.fchmodSync=chmodFixSync(e.fchmodSync);e.lchmodSync=chmodFixSync(e.lchmodSync);e.stat=statFix(e.stat);e.fstat=statFix(e.fstat);e.lstat=statFix(e.lstat);e.statSync=statFixSync(e.statSync);e.fstatSync=statFixSync(e.fstatSync);e.lstatSync=statFixSync(e.lstatSync);if(e.chmod&&!e.lchmod){e.lchmod=function(e,t,n){n&&f.nextTick(n)};e.lchmodSync=function(){}}if(e.chown&&!e.lchown){e.lchown=function(e,t,n,r){r&&f.nextTick(r)};e.lchownSync=function(){}}"win32"===p&&(e.rename="function"!==typeof e.rename?e.rename:function(t){function rename(n,r,o){var i=Date.now();var a=0;t(n,r,(function CB(c){if(c&&("EACCES"===c.code||"EPERM"===c.code||"EBUSY"===c.code)&&Date.now()-i<6e4){setTimeout((function(){e.stat(r,(function(e,i){e&&"ENOENT"===e.code?t(n,r,CB):o(c)}))}),a);a<100&&(a+=10)}else o&&o(c)}))}Object.setPrototypeOf&&Object.setPrototypeOf(rename,t);return rename}(e.rename));e.read="function"!==typeof e.read?e.read:function(t){function read(n,r,o,i,a,u){var f;if(u&&"function"===typeof u){var l=0;f=function(s,d,p){if(s&&"EAGAIN"===s.code&&l<10){l++;return t.call(e,n,r,o,i,a,f)}u.apply(this||c,arguments)}}return t.call(e,n,r,o,i,a,f)}Object.setPrototypeOf&&Object.setPrototypeOf(read,t);return read}(e.read);e.readSync="function"!==typeof e.readSync?e.readSync:function(t){return function(n,r,o,i,a){var c=0;while(true)try{return t.call(e,n,r,o,i,a)}catch(e){if("EAGAIN"===e.code&&c<10){c++;continue}throw e}}}(e.readSync);function patchLchmod(e){e.lchmod=function(t,n,r){e.open(t,l.O_WRONLY|l.O_SYMLINK,n,(function(t,o){t?r&&r(t):e.fchmod(o,n,(function(t){e.close(o,(function(e){r&&r(t||e)}))}))}))};e.lchmodSync=function(t,n){var r=e.openSync(t,l.O_WRONLY|l.O_SYMLINK,n);var o=true;var i;try{i=e.fchmodSync(r,n);o=false}finally{if(o)try{e.closeSync(r)}catch(e){}else e.closeSync(r)}return i}}function patchLutimes(e){if(l.hasOwnProperty("O_SYMLINK")&&e.futimes){e.lutimes=function(t,n,r,o){e.open(t,l.O_SYMLINK,(function(t,i){t?o&&o(t):e.futimes(i,n,r,(function(t){e.close(i,(function(e){o&&o(t||e)}))}))}))};e.lutimesSync=function(t,n,r){var o=e.openSync(t,l.O_SYMLINK);var i;var a=true;try{i=e.futimesSync(o,n,r);a=false}finally{if(a)try{e.closeSync(o)}catch(e){}else e.closeSync(o)}return i}}else if(e.futimes){e.lutimes=function(e,t,n,r){r&&f.nextTick(r)};e.lutimesSync=function(){}}}function chmodFix(t){return t?function(n,r,o){return t.call(e,n,r,(function(e){chownErOk(e)&&(e=null);o&&o.apply(this||c,arguments)}))}:t}function chmodFixSync(t){return t?function(n,r){try{return t.call(e,n,r)}catch(e){if(!chownErOk(e))throw e}}:t}function chownFix(t){return t?function(n,r,o,i){return t.call(e,n,r,o,(function(e){chownErOk(e)&&(e=null);i&&i.apply(this||c,arguments)}))}:t}function chownFixSync(t){return t?function(n,r,o){try{return t.call(e,n,r,o)}catch(e){if(!chownErOk(e))throw e}}:t}function statFix(t){return t?function(n,r,o){if("function"===typeof r){o=r;r=null}function callback(e,t){if(t){t.uid<0&&(t.uid+=4294967296);t.gid<0&&(t.gid+=4294967296)}o&&o.apply(this||c,arguments)}return r?t.call(e,n,r,callback):t.call(e,n,callback)}:t}function statFixSync(t){return t?function(n,r){var o=r?t.call(e,n,r):t.call(e,n);if(o){o.uid<0&&(o.uid+=4294967296);o.gid<0&&(o.gid+=4294967296)}return o}:t}function chownErOk(e){if(!e)return true;if("ENOSYS"===e.code)return true;var t=!f.getuid||0!==f.getuid();return!(!t||"EINVAL"!==e.code&&"EPERM"!==e.code)}}var y=u;var m="default"in r?r.default:r;var S="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var v={};var b=n;var w=m.Stream;v=legacy$1;function legacy$1(e){return{ReadStream:ReadStream,WriteStream:WriteStream};function ReadStream(t,n){if(!((this||S)instanceof ReadStream))return new ReadStream(t,n);w.call(this||S);var r=this||S;(this||S).path=t;(this||S).fd=null;(this||S).readable=true;(this||S).paused=false;(this||S).flags="r";(this||S).mode=438;(this||S).bufferSize=65536;n=n||{};var o=Object.keys(n);for(var i=0,a=o.length;i<a;i++){var c=o[i];(this||S)[c]=n[c]}(this||S).encoding&&this.setEncoding((this||S).encoding);if(void 0!==(this||S).start){if("number"!==typeof(this||S).start)throw TypeError("start must be a Number");if(void 0===(this||S).end)(this||S).end=Infinity;else if("number"!==typeof(this||S).end)throw TypeError("end must be a Number");if((this||S).start>(this||S).end)throw new Error("start must be <= end");(this||S).pos=(this||S).start}null===(this||S).fd?e.open((this||S).path,(this||S).flags,(this||S).mode,(function(e,t){if(e){r.emit("error",e);r.readable=false}else{r.fd=t;r.emit("open",t);r._read()}})):b.nextTick((function(){r._read()}))}function WriteStream(t,n){if(!((this||S)instanceof WriteStream))return new WriteStream(t,n);w.call(this||S);(this||S).path=t;(this||S).fd=null;(this||S).writable=true;(this||S).flags="w";(this||S).encoding="binary";(this||S).mode=438;(this||S).bytesWritten=0;n=n||{};var r=Object.keys(n);for(var o=0,i=r.length;o<i;o++){var a=r[o];(this||S)[a]=n[a]}if(void 0!==(this||S).start){if("number"!==typeof(this||S).start)throw TypeError("start must be a Number");if((this||S).start<0)throw new Error("start must be >= zero");(this||S).pos=(this||S).start}(this||S).busy=false;(this||S)._queue=[];if(null===(this||S).fd){(this||S)._open=e.open;(this||S)._queue.push([(this||S)._open,(this||S).path,(this||S).flags,(this||S).mode,void 0]);this.flush()}}}var g=v;var F={};F=clone$1;var E=Object.getPrototypeOf||function(e){return e.__proto__};function clone$1(e){if(null===e||"object"!==typeof e)return e;if(e instanceof Object)var t={__proto__:E(e)};else t=Object.create(null);Object.getOwnPropertyNames(e).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}));return t}var O=F;var _="default"in e?e.default:e;var R="default"in o?o.default:o;var x="default"in i?i.default:i;var L="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var $={};var W=n;var j=_;var N=y;var T=g;var I=O;var P=R;var D;var M;if("function"===typeof Symbol&&"function"===typeof Symbol.for){D=Symbol.for("graceful-fs.queue");M=Symbol.for("graceful-fs.previous")}else{D="___graceful-fs.queue";M="___graceful-fs.previous"}function noop(){}function publishQueue(e,t){Object.defineProperty(e,D,{get:function(){return t}})}var k=noop;P.debuglog?k=P.debuglog("gfs4"):/\bgfs4\b/i.test(W.env.NODE_DEBUG||"")&&(k=function(){var e=P.format.apply(P,arguments);e="GFS4: "+e.split(/\n/).join("\nGFS4: ");console.error(e)});if(!j[D]){var q=L[D]||[];publishQueue(j,q);j.close=function(e){function close(t,n){return e.call(j,t,(function(e){e||resetQueue();"function"===typeof n&&n.apply(this||L,arguments)}))}Object.defineProperty(close,M,{value:e});return close}(j.close);j.closeSync=function(e){function closeSync(t){e.apply(j,arguments);resetQueue()}Object.defineProperty(closeSync,M,{value:e});return closeSync}(j.closeSync);/\bgfs4\b/i.test(W.env.NODE_DEBUG||"")&&W.on("exit",(function(){k(j[D]);x.equal(j[D].length,0)}))}L[D]||publishQueue(L,j[D]);$=patch(I(j));if(W.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!j.__patched){$=patch(j);j.__patched=true}function patch(e){N(e);e.gracefulify=patch;e.createReadStream=createReadStream;e.createWriteStream=createWriteStream;var t=e.readFile;e.readFile=readFile;function readFile(e,n,r){"function"===typeof n&&(r=n,n=null);return go$readFile(e,n,r);function go$readFile(e,n,r,o){return t(e,n,(function(t){!t||"EMFILE"!==t.code&&"ENFILE"!==t.code?"function"===typeof r&&r.apply(this||L,arguments):enqueue([go$readFile,[e,n,r],t,o||Date.now(),Date.now()])}))}}var n=e.writeFile;e.writeFile=writeFile;function writeFile(e,t,r,o){"function"===typeof r&&(o=r,r=null);return go$writeFile(e,t,r,o);function go$writeFile(e,t,r,o,i){return n(e,t,r,(function(n){!n||"EMFILE"!==n.code&&"ENFILE"!==n.code?"function"===typeof o&&o.apply(this||L,arguments):enqueue([go$writeFile,[e,t,r,o],n,i||Date.now(),Date.now()])}))}}var r=e.appendFile;r&&(e.appendFile=appendFile);function appendFile(e,t,n,o){"function"===typeof n&&(o=n,n=null);return go$appendFile(e,t,n,o);function go$appendFile(e,t,n,o,i){return r(e,t,n,(function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?"function"===typeof o&&o.apply(this||L,arguments):enqueue([go$appendFile,[e,t,n,o],r,i||Date.now(),Date.now()])}))}}var o=e.copyFile;o&&(e.copyFile=copyFile);function copyFile(e,t,n,r){if("function"===typeof n){r=n;n=0}return go$copyFile(e,t,n,r);function go$copyFile(e,t,n,r,i){return o(e,t,n,(function(o){!o||"EMFILE"!==o.code&&"ENFILE"!==o.code?"function"===typeof r&&r.apply(this||L,arguments):enqueue([go$copyFile,[e,t,n,r],o,i||Date.now(),Date.now()])}))}}var i=e.readdir;e.readdir=readdir;var a=/^v[0-5]\./;function readdir(e,t,n){"function"===typeof t&&(n=t,t=null);var r=a.test(W.version)?function go$readdir(e,t,n,r){return i(e,fs$readdirCallback(e,t,n,r))}:function go$readdir(e,t,n,r){return i(e,t,fs$readdirCallback(e,t,n,r))};return r(e,t,n);function fs$readdirCallback(e,t,n,o){return function(i,a){if(!i||"EMFILE"!==i.code&&"ENFILE"!==i.code){a&&a.sort&&a.sort();"function"===typeof n&&n.call(this||L,i,a)}else enqueue([r,[e,t,n],i,o||Date.now(),Date.now()])}}}if("v0.8"===W.version.substr(0,4)){var c=T(e);ReadStream=c.ReadStream;WriteStream=c.WriteStream}var u=e.ReadStream;if(u){ReadStream.prototype=Object.create(u.prototype);ReadStream.prototype.open=ReadStream$open}var f=e.WriteStream;if(f){WriteStream.prototype=Object.create(f.prototype);WriteStream.prototype.open=WriteStream$open}Object.defineProperty(e,"ReadStream",{get:function(){return ReadStream},set:function(e){ReadStream=e},enumerable:true,configurable:true});Object.defineProperty(e,"WriteStream",{get:function(){return WriteStream},set:function(e){WriteStream=e},enumerable:true,configurable:true});var l=ReadStream;Object.defineProperty(e,"FileReadStream",{get:function(){return l},set:function(e){l=e},enumerable:true,configurable:true});var s=WriteStream;Object.defineProperty(e,"FileWriteStream",{get:function(){return s},set:function(e){s=e},enumerable:true,configurable:true});function ReadStream(e,t){return(this||L)instanceof ReadStream?(u.apply(this||L,arguments),this||L):ReadStream.apply(Object.create(ReadStream.prototype),arguments)}function ReadStream$open(){var e=this||L;open(e.path,e.flags,e.mode,(function(t,n){if(t){e.autoClose&&e.destroy();e.emit("error",t)}else{e.fd=n;e.emit("open",n);e.read()}}))}function WriteStream(e,t){return(this||L)instanceof WriteStream?(f.apply(this||L,arguments),this||L):WriteStream.apply(Object.create(WriteStream.prototype),arguments)}function WriteStream$open(){var e=this||L;open(e.path,e.flags,e.mode,(function(t,n){if(t){e.destroy();e.emit("error",t)}else{e.fd=n;e.emit("open",n)}}))}function createReadStream(t,n){return new e.ReadStream(t,n)}function createWriteStream(t,n){return new e.WriteStream(t,n)}var d=e.open;e.open=open;function open(e,t,n,r){"function"===typeof n&&(r=n,n=null);return go$open(e,t,n,r);function go$open(e,t,n,r,o){return d(e,t,n,(function(i,a){!i||"EMFILE"!==i.code&&"ENFILE"!==i.code?"function"===typeof r&&r.apply(this||L,arguments):enqueue([go$open,[e,t,n,r],i,o||Date.now(),Date.now()])}))}}return e}function enqueue(e){k("ENQUEUE",e[0].name,e[1]);j[D].push(e);retry()}var Y;function resetQueue(){var e=Date.now();for(var t=0;t<j[D].length;++t)if(j[D][t].length>2){j[D][t][3]=e;j[D][t][4]=e}retry()}function retry(){clearTimeout(Y);Y=void 0;if(0!==j[D].length){var e=j[D].shift();var t=e[0];var n=e[1];var r=e[2];var o=e[3];var i=e[4];if(void 0===o){k("RETRY",t.name,n);t.apply(null,n)}else if(Date.now()-o>=6e4){k("TIMEOUT",t.name,n);var a=n.pop();"function"===typeof a&&a.call(null,r)}else{var c=Date.now()-i;var u=Math.max(i-o,1);var f=Math.min(1.2*u,100);if(c>=f){k("RETRY",t.name,n);t.apply(null,n.concat([o]))}else j[D].push(e)}void 0===Y&&(Y=setTimeout(retry,0))}}var A=$;export{A as default};

